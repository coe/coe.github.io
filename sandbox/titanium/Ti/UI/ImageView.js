define(["Ti/_/declare","Ti/_/event","Ti/_/lang","Ti/_/style","Ti/_/UI/Widget","Ti/UI","Ti/Filesystem"],function(e,a,t,i,n,s,o){var r=i.set,_=require.is,l=require.on,d=e(n,{domType:"img",onload:null,onerror:null,constructor:function(){this.domNode.ondragstart=function(){return!1}},_getContentSize:function(){return{width:this.domNode.width,height:this.domNode.height}},_preLayout:function(e,a,t,i){this.domNode.style.width="",this.domNode.style.height="";var n=this.domNode.width/this.domNode.height,o=this.properties.__values__,r=o.width,_=o.height;return t||i?t?i?(o.width=s.SIZE,o.height=s.SIZE):(o.width=a*n,o.height=a):(o.width=e,o.height=e/n):e/a>n?(o.width=a*n,o.height=a):(o.width=e,o.height=e/n),r!==o.width||_!==o.height},_imageRatio:1,properties:{src:{set:function(e){var i,n=this.domNode,s="none",o=t.hitch(this,function(e){a.off(i),this._triggerLayout(),this.onerror&&this.onerror(e)});return e&&(s="inherit",i=[l(n,"load",this,function(){n.style.width="",n.style.height="";var e=n.width/n.height;isNaN(e)&&(e=0===n.width?1:1/0),this._imageRatio=e,this._triggerLayout(),this.onload&&this.onload()}),l(n,"error",o),l(n,"abort",o)],n.src=require.cache(e)||e),r(n,"display",s),e}}}});return e("Ti.UI.ImageView",n,{_createImage:function(e,a,t){var i=_(e,"String")&&e.match(/^(.+)\:\/\//);switch(i&&~o.protocols.indexOf(i[1])&&(e=o.getFile(e)),e&&e.declaredClass){case"Ti.Filesystem.File":e=e.read();case"Ti.Blob":e=""+e}return new d({onload:a,onerror:t,src:e})},_defaultWidth:s.SIZE,_defaultHeight:s.SIZE,_slideshowCount:0,_setSlideshowInterval:function(){var e=this,a=e._images;clearInterval(this._slideshowTimer),this._slideshowTimer=setInterval(function(){var t=!1;return r(a[e._currentIndex].domNode,"display","none"),e.reverse?0===--e._currentIndex&&(e._currentIndex=e.images.length-1,t=!0):++e._currentIndex===e.images.length&&(e._currentIndex=0,t=!0),r(a[e._currentIndex].domNode,"display","inherit"),e.repeatCount&&t&&++e._slideshowCount===e.repeatCount?(e.stop(),void 0):(e.fireEvent("change",{index:e._currentIndex}),void 0)},this.duration)},start:function(){this._images&&(this._setState(0,1),this._slideshowCount=0,this._setSlideshowInterval(),this.fireEvent("start"))},stop:function(){var e=this._images;if(e){if(clearInterval(this._slideshowTimer),e.length){var a=0;this.reverse&&(a=e.length-1),this._currentIndex&&r(e[this._currentIndex].domNode,"display","none"),r(e[a].domNode,"display","inherit"),this._currentIndex=a}this._setState(0,0),this.fireEvent("stop")}},pause:function(){this._images&&(clearInterval(this._slideshowTimer),this._setState(1,0),this.fireEvent("pause"))},resume:function(){this._images&&(this._setSlideshowInterval(),this._setState(0,1))},_setState:function(e,a){this.constants.paused=!!e,this.constants.animating=!!a},constants:{animating:!1,paused:!1},properties:{duration:{set:function(e){return Math.max(30,e)},value:200},image:{set:function(e){return this._removeAllChildren(),this._images=void 0,this._add(this._createImage(e,function(){this.fireEvent("load",{state:"image"})},function(e){this.fireEvent("error",e)})),e}},images:{set:function(e){var a=void 0,t=0,i=0;return this._removeAllChildren(),_(e,"Array")&&(a=[],e.forEach(function(n){var s=this._createImage(n,function(){!i&&++t===e.length&&this.fireEvent("load",{state:"image"})},function(e){i||(i=1)&&this.fireEvent("error",e)});r(s.domNode,"display","none"),a.push(s),this._add(s)},this)),this._images=a,e},post:function(){this.stop()}},repeatCount:0,reverse:!1}})});