define(["Ti/_/Evented","Ti/_/lang"],function(e,t){function i(){FB.init({appId:u,status:!1,cookie:!0,oauth:!0,xfbml:!0}),FB.getLoginStatus(function(e){s=!0,"connected"==e.status&&r(e)||l&&o()},!0)}function r(e){var t=e.authResponse;return t?(a.loggedIn=!0,a.uid=t.userID,a.expirationDate=new Date(Date.now()+1e3*t.expiresIn),a.accessToken=t.accessToken,t.expiresIn&&setTimeout(function(){a.logout()},1e3*t.expiresIn),a.fireEvent("login",{cancelled:!1,data:e,success:!0,uid:a.uid}),!0):void 0}function n(e,t,i,r){result={source:a,success:!1},result[t]=i,!e||e.error?e&&(result.error=e.error):(result.success=!0,result.result=JSON.stringify(e)),r(result)}function o(){FB.login(function(e){r(e)||a.fireEvent("login",{cancelled:!0,data:e,error:"user cancelled or an internal error occured.",success:!1,uid:e.id})},{scope:a.permissions.join()})}var a,s=!1,l=!1,u=null,c="not logged in",d=document.createElement("div"),p="facebook-jssdk",f=!1;if(a=t.setObject("Ti.Facebook",e,{authorize:function(){if(!u)throw Error("App ID not set. Facebook authorization cancelled.");s?o():l=!0},createLoginButton:function(e){return new(require("Ti/Facebook/LoginButton"))(e)},dialog:function(e,t,i){a.loggedIn?(t.method=e,FB.ui(t,function(t){n(t,"action",e,i)})):i({success:!1,error:c,action:e,source:a})},logout:function(){a.loggedIn&&FB.logout(function(){a.loggedIn=!1,a.fireEvent("logout",{success:!0})})},request:function(e,t,i){a.loggedIn?(t.method=e,t.urls="facebook.com,developers.facebook.com",FB.api(t,function(t){n(t,"method",e,i)})):i({success:!1,error:c,method:e,source:a})},requestWithGraphPath:function(e,t,i,r){a.loggedIn?FB.api(e,i,t,function(t){n(t,"path",e,r)}):r({success:!1,error:c,path:e,source:a})},constants:{BUTTON_STYLE_NORMAL:1,BUTTON_STYLE_WIDE:2},properties:{accessToken:void 0,appid:{set:function(e){return u=e,f&&i(),e}},expirationDate:void 0,forceDialogAuth:!0,loggedIn:!1,permissions:void 0,uid:void 0}}),d.id="fb-root",document.body.appendChild(d),!document.getElementById(p)){var _=document.createElement("script"),h=document.getElementsByTagName("head")[0];_.id=p,_.async=!0,_.src="//connect.facebook.net/en_US/all.js",h.insertBefore(_,h.firstChild)}return window.fbAsyncInit=function(){f=!0,u&&i()},a});