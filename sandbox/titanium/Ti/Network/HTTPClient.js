define(["Ti/_","Ti/_/declare","Ti/_/has","Ti/_/lang","Ti/_/Evented","Ti/Filesystem","Ti/Network","Ti/Blob","Ti/_/event","Ti/App"],function(e,a,t,i,n,s,o,r,_,l){var d=require.is,c=require.on;return a("Ti.Network.HTTPClient",n,{constructor:function(){var e=this._xhr=new XMLHttpRequest;this._handles=[c(e,"error",this,"_onError"),e.upload&&c(e.upload,"error",this,"_onError"),c(e,"progress",this,function(e){e.progress=e.lengthComputable?e.loaded/e.total:!1,d(this.ondatastream,"Function")&&this.ondatastream.call(this,e)}),e.upload&&c(e.upload,"progress",this,function(e){e.progress=e.lengthComputable?e.loaded/e.total:!1,d(this.onsendstream,"Function")&&this.onsendstream.call(this,e)})],e.onreadystatechange=i.hitch(this,function(){var a,i=this.constants,n=this.onload;switch(e.readyState){case 0:i.readyState=this.UNSENT;break;case 1:i.readyState=this.OPENED;break;case 2:i.readyState=this.LOADING;break;case 3:i.readyState=this.HEADERS_RECEIVED;break;case 4:clearTimeout(this._timeoutTimer),this._completed=1,i.readyState=this.DONE,this._aborted||((a=this.file)&&(a=s.getFile(a),a.writable&&a.write(e.responseText)),i.responseText=e.responseText,i.responseData=new r({data:e.responseText,length:e.responseText.length,mimeType:e.getResponseHeader("Content-Type")||"text/plain"}),i.responseXML=e.responseXML,t("ti-instrumentation")&&instrumentation.stopTest(this._requestInstrumentationTest,this.location),e.status>=400&&(n=this._onError),d(n,"Function")&&n.call(this))}this._fireStateChange()})},destroy:function(){this._xhr&&(this._xhr.abort(),this._xhr=null),_.off(this._handles),n.destroy.apply(this,arguments)},_onError:function(e){this.abort(),d(e,"Object")||(e={message:e}),e.source=this,e.type="error",e.error||(e.error=e.message||this._xhr.status),parseInt(e.error)||(e.error="Can't reach host"),d(this.onerror,"Function")&&this.onerror.call(this,e)},abort:function(){clearTimeout(this._timeoutTimer),this._aborted=1,this.connected&&this._xhr.abort(),this.constants.readyState=this.UNSENT,this._fireStateChange()},_fireStateChange:function(){d(this.onreadystatechange,"Function")&&this.onreadystatechange.call(this)},getResponseHeader:function(e){return this._xhr.readyState>1?this._xhr.getResponseHeader(e):null},open:function(a,t,i){var n=Ti.Network.httpURLFormatter,s=this.constants,o=this.withCredentials,r=e.getAbsolutePath(n?n(t):t),_=r.match(/^((?:.+\:)?\/\/)?(?:.+@)?(.*)$/);_&&this.username&&this.password&&(r=(_[1]||"")+(this.domain?this.domain+"\\":"")+this.username+":"+this.password+"@"+_[2]),this.abort(),this._xhr.open(s.connectionType=a,s.location=r,o||void 0===i?!0:!!i),o&&(this._xhr.withCredentials=o)},send:function(e){try{var a=0|this.timeout;this._aborted=this._completed=0,t("ti-instrumentation")&&(this._requestInstrumentationTest=instrumentation.startTest("HTTP Request")),e=d(e,"Object")?i.urlEncode(e):e,this._contentTypeSet||e&&this._xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this._xhr.setRequestHeader("X-Titanium-Id",l.guid),this._xhr.send(e),clearTimeout(this._timeoutTimer),a&&(this._timeoutTimer=setTimeout(i.hitch(this,function(){this.connected&&(this.abort(),!this._completed&&this._onError("Request timed out"))}),a))}catch(n){}},setRequestHeader:function(e,a){"Content-Type"===e&&(this._contentTypeSet=1),this._xhr.setRequestHeader(e,a)},properties:{ondatastream:void 0,onerror:void 0,onload:void 0,onreadystatechange:void 0,onsendstream:void 0,timeout:void 0,username:null,password:null,domain:null,withCredentials:!1},constants:{DONE:4,HEADERS_RECEIVED:2,LOADING:3,OPENED:1,UNSENT:1,connected:function(){return this.readyState>=this.OPENED},connectionType:void 0,location:void 0,readyState:this.UNSENT,responseData:void 0,responseText:void 0,responseXML:void 0,status:function(){return this._xhr.status},statusText:function(){return this._xhr.statusText}}})});