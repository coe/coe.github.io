define(["Ti/_/css","Ti/_/declare","Ti/_/dom","Ti/_/event","Ti/_/has","Ti/_/lang","Ti/_/style","Ti/_/Evented","Ti/UI","Ti/UI/Animation"],function(e,a,t,i,n,s,o,r,_,l){var d=window,c=t.unitize,u=t.computeSize,p=require.on,m=o.set,g=require.is,k=s.isDef,b={post:"_doBackground"},h=function(e,a){return(null===e||!g(e,"String")&&!g(e,"Number"))&&(e=void 0),e!==a&&!this._batchUpdateInProgress&&this._triggerLayout(),e},y={set:h},f="px",v=n("touch");return a("Ti._.UI.Element",r,{domType:null,domNode:null,_alive:1,constructor:function(){var a=this,n=0;a.domNode=a._setFocusNode(t.create(a.domType||"div",{className:"TiUIElement "+e.clean(a.declaredClass),"data-widget-id":a.widgetId})),a._children=[],p(a,"touchstart",a,"_doBackground"),p(a,"touchend",a,"_doBackground"),p(a.domNode,v?"touchstart":"mousedown",function(e){var t=[p(d,v?"touchmove":"mousemove",function(e){(v||n)&&(e._elements||(e._elements=[])).push(a)}),p(d,v?"touchend":"mouseup",function(e){n=0,(e._elements||(e._elements=[])).push(a),i.off(t)}),v&&p(d,"touchcancel",function(e){(e._elements||(e._elements=[])).push(a),i.off(t)})];n=1,(e._elements||(e._elements=[])).push(a)});var s=a.constants.__values__;a._layoutCoefficients={width:{x1:0,x2:0,x3:0},minWidth:{x1:0,x2:0,x3:0},sandboxWidth:{x1:0,x2:0,x3:0},height:{x1:0,x2:0,x3:0},minHeight:{x1:0,x2:0,x3:0},sandboxHeight:{x1:0,x2:0,x3:0},left:{x1:0,x2:0,x3:0},top:{x1:0,x2:0,x3:0,x4:0}},s.size={x:0,y:0,width:0,height:0},s.rect={x:0,y:0,width:0,height:0}},fireEvent:function(e,a){a=a||{};var t,i=a.bubbles;r.fireEvent.call(this,e,a),i&&!a.cancelBubble&&this.bubbleParent&&this._parent&&(k(a.x)&&(t=this.convertPointToView({x:a.x,y:a.y},this._parent),a.x=t?t.x:a.x,a.y=t?t.y:a.y),this._parent.fireEvent(e,a))},_setParent:function(e){this._parent=e},_add:function(e,a){e._hidden=a,e._setParent(this),this._children.push(e),this.containerNode.appendChild(e.domNode),e._triggerLayout()},_insertAt:function(e,a,t){var i=this._children;a>i.length||0>a||(a===i.length?this._add(e,t):(e._parent=this,this.containerNode.insertBefore(e.domNode,i[a].domNode),i.splice(a,0,e),this._triggerLayout()))},_remove:function(e){var a=this._children,i=a.indexOf(e);-1!==i&&(a.splice(i,1),e._setParent(),t.detach(e.domNode),this._triggerLayout())},_removeAllChildren:function(){for(var e=this._children;e.length;)this.remove(e[0]);this._triggerLayout()},destroy:function(){if(this._alive){for(var e=this._children;e.length;)e.splice(0,1)[0].destroy();this._parent&&this._parent._remove(this),this.domNode&&(t.destroy(this.domNode),this.domNode=null)}r.destroy.apply(this,arguments)},_isAttachedToActiveWin:function(){for(var e=!1,a=this;a;){if(a===_._container){e=!0;break}a=a._parent}return e},_needsMeasuring:!0,_triggerLayout:function(e){this._needsMeasuring=!0,this._isAttachedToActiveWin()&&(!this._batchUpdateInProgress||e)&&_._triggerLayout(this,e)},_hasSizeDimensions:function(){return this._hasSizeWidth()||this._hasSizeHeight()},_hasSizeHeight:function(){return isNaN(this._layoutCoefficients.height.x1)},_hasSizeWidth:function(){return isNaN(this._layoutCoefficients.width.x1)},startLayout:function(){this._batchUpdateInProgress=!0},finishLayout:function(){this._batchUpdateInProgress=!1,_._triggerLayout(this,!0)},updateLayout:function(e){this.startLayout();for(var a=0,t=e.length;t>a;a++)this[a]=e[a];this.finishLayout()},convertPointToView:function(e,a){function t(e,a,t){for(var i=a.x,n=a.y,s=t?1:-1;e;)i+=s*e.domNode.offsetLeft,n+=s*e.domNode.offsetTop,e=e._parent;return{x:i,y:n}}if(!this._isAttachedToActiveWin()||!a._isAttachedToActiveWin())return null;if(!e||!g(e.x,"Number")||!g(e.y,"Number"))throw Error("Invalid point");if(!a.domNode)throw Error("Invalid destination view");return t(a,t(this,e,!0),!1)},_getContentOffset:function(){return{x:0,y:0}},_computeGradient:function(){var e=this.backgroundGradient;colors=e.colors,type=e.type,cssVal=type+"-gradient(";var a=u(e.startPoint.x,this._measuredWidth),t=u(e.startPoint.y,this._measuredHeight),i=u("50%",this._measuredWidth),n=u("50%",this._measuredHeight),s=colors.length;if("linear"===type){var o,r,_=u(e.endPoint.x,this._measuredWidth),l=u(e.endPoint.y,this._measuredHeight);if(.01>Math.abs(a-_))l>t?(o=t,r=l,cssVal+="270deg"):(o=l,r=t,cssVal+="90deg");else if(.01>Math.abs(t-l))_>a?(o=a,r=_,cssVal+="0deg"):(o=_,r=a,cssVal+="180deg");else{var d=!1;if(a>_){d=!0;var c=a;a=_,_=c,c=t,t=l,l=c}var p=Math.atan2(l-t,_-a);if(tanAngle=Math.tan(p),cosAngle=Math.cos(p),originLineIntersection=n-i*tanAngle,userDistance=(t-a*tanAngle-originLineIntersection)*cosAngle,userXOffset=userDistance*Math.sin(p),userYOffset=userDistance*cosAngle,a+=userXOffset,t-=userYOffset,_+=userXOffset,l-=userYOffset,shiftedAngle=Math.PI/2-p,p>0){var k=originLineIntersection*Math.sin(shiftedAngle),b=-k*Math.cos(shiftedAngle),h=k*Math.sin(shiftedAngle);o=Math.sqrt(Math.pow(a-b,2)+Math.pow(t-h,2)),r=Math.sqrt(Math.pow(_-b,2)+Math.pow(l-h,2))}else{var k=(this._measuredHeight-originLineIntersection)*Math.sin(shiftedAngle),b=-k*Math.cos(shiftedAngle),h=this._measuredHeight-k*Math.sin(shiftedAngle);o=Math.sqrt(Math.pow(a-b,2)+Math.pow(t-h,2)),r=Math.sqrt(Math.pow(_-b,2)+Math.pow(l-h,2))}p=d?p+Math.PI:p,cssVal+=Math.round(360*(2*Math.PI-p)/(2*Math.PI))+"deg"}for(var y=0;s>y;y++){var v=colors[y];g(v,"String")&&(v={color:v}),g(v.offset,"Number")||(v.offset=y/(s-1)),cssVal+=","+v.color+" "+Math.round(u(100*v.offset+"%",r-o)+o)+f}}else if("radial"===type){var w=Math.min(this._measuredWidth,this._measuredHeight),z=u(e.startRadius,w),S=u(e.endRadius,w),j=[],d=!1;if(z>S){var c=z;z=S,S=c,d=!0;for(var y=0;(s-2)/2>=y;y++){var P=s-y-1;j[y]=colors[P],j[P]=colors[y]}if(1===s%2){var A=Math.floor(s/2);j[A]=colors[A]}}else for(var y=0;s>y;y++)j[y]=colors[y];cssVal+=a+f+" "+t+f;for(var y=0;s>y;y++){var v=j[y];g(v,"String")&&(v={color:v});var T;T=g(v.offset,"Number")?d?1===s%2&&y===Math.floor(s/2)?v.offset:1-v.offset:v.offset:y/(s-1),cssVal+=","+v.color+" "+Math.round(u(100*T+"%",S-z)+z)+f}}require.config.vendorPrefixes.css.forEach(function(e){m(this.domNode,"backgroundImage",e+cssVal+")")},this)},_defaultBackgroundColor:void 0,_defaultBackgroundImage:void 0,_defaultBackgroundDisabledColor:void 0,_defaultBackgroundDisabledImage:void 0,_defaultBackgroundFocusedColor:void 0,_defaultBackgroundFocusedImage:void 0,_defaultBackgroundSelectedColor:void 0,_defaultBackgroundSelectedImage:void 0,_borderLeftWidth:0,_borderRightWidth:0,_borderTopWidth:0,_borderBottomWidth:0,_getBorderFromCSS:function(){setTimeout(s.hitch(this,function(){var e=d.getComputedStyle(this.domNode),a=parseInt(e["border-left-width"]),t=parseInt(e["border-right-width"]),i=parseInt(e["border-top-width"]),n=parseInt(e["border-bottom-width"]);isNaN(a)||isNaN(t)||isNaN(i)||isNaN(n)||(this.borderWidth=a===t&&a===i&&a===n?a:[a,t,i,n])}),1)},_doBackground:function(e){if(!this.backgroundGradient){e=e||{};var a,t=(e.type||"").match(/mouse(over|out)/),i=this.backgroundImage||this._defaultBackgroundImage||"none",n=this.backgroundColor||this._defaultBackgroundColor,s=this.backgroundRepeat,r=this.domNode.style;this._touching&&(n=this.backgroundSelectedColor||this._defaultBackgroundSelectedColor||n,i=this.backgroundSelectedImage||this._defaultBackgroundSelectedImage||i),t&&(this._over="over"===t[1]),!this._touching&&this.focusable&&this._over&&(n=this.backgroundFocusedColor||this._defaultBackgroundFocusedColor||n,i=this.backgroundFocusedImage||this._defaultBackgroundFocusedImage||i),this.enabled||(n=this.backgroundDisabledColor||this._defaultBackgroundDisabledColor||n,i=this.backgroundDisabledImage||this._defaultBackgroundDisabledImage||i),n=n||(i&&"none"!==i?"transparent":""),r.backgroundColor.toLowerCase()!==n.toLowerCase()&&(r.backgroundColor=n),i=o.url(i),r.backgroundImage.replace(/'|"/g,"").toLowerCase()!==i.toLowerCase()&&(r.backgroundImage=i),i&&(a=s?"repeat":"no-repeat",r.backgroundRepeat!==a&&(r.backgroundRepeat=a),a=s?"auto":"100% 100%",r.backgroundSize.replace(/(100%) 100%/,"$1")!==a&&(r.backgroundSize=a))}},_setFocusNode:function(e){var a=this._focus=this._focus||{};return a.node!==e&&(a.node&&(i.off(a.evts),i.off(a.evtsMore)),a.node=e,a.evts=[p(e,"focus",this,"_doBackground"),p(e,"blur",this,"_doBackground")]),e},show:function(){this.visible=!0},hide:function(){this.visible=!1},animate:function(e,a){return this._isAttachedToActiveWin()&&l._play(this,e&&"Ti.UI.Animation"===e.declaredClass?e:new l(e)).then(a)},_setTouchEnabled:function(e){var a,t=this._children,i=0,n=t.length;for(m(this.domNode,"pointerEvents",e?"auto":"none");n>i;i++)a=t[i],a._setTouchEnabled(e&&a.touchEnabled)},_measuredLeft:0,_measuredTop:0,_measuredWidth:0,_measuredHeight:0,_measuredSandboxWidth:0,_measuredSandboxHeight:0,constants:{size:{get:function(){return{x:0,y:0,width:this._measuredWidth,height:this._measuredHeight}}},rect:{get:function(){return{x:this._measuredLeft,y:this._measuredTop,width:this._measuredWidth,height:this._measuredHeight}}},parent:function(){return this._parent}},properties:{backgroundColor:b,backgroundDisabledColor:b,backgroundDisabledImage:b,backgroundFocusedColor:b,backgroundFocusedImage:b,backgroundGradient:{set:function(e){if(g(e.type,"String")&&g(e.colors,"Array")&&!(2>e.colors.length)){var a=e.type,t=e.startPoint,i=e.endPoint;if("linear"===a)t&&"x"in t&&"y"in t||(e.startPoint={x:"0%",y:"50%"}),i&&"x"in i&&"y"in i||(e.endPoint={x:"100%",y:"50%"});else{if("radial"!==a)return;t&&"x"in t&&"y"in t||(e.startPoint={x:"50%",y:"50%"})}return e}},post:function(){this.backgroundGradient&&this._computeGradient()}},backgroundImage:b,backgroundRepeat:b,backgroundSelectedColor:b,backgroundSelectedImage:b,borderColor:{set:function(e){return m(this.domNode,"borderColor",e),e}},borderRadius:{set:function(e){return m(this.domNode,"borderRadius",c(e)),e},value:0},borderWidth:{set:function(e,a){if(g(e,"Array")){if(4!==e.length)return a;m(this.domNode,{borderLeftWidth:(this._borderLeftWidth=e[0])+f,borderRightWidth:(this._borderRightWidth=e[1])+f,borderTopWidth:(this._borderTopWidth=e[2])+f,borderBottomWidth:(this._borderBottomWidth=e[3])+f}),this._borderSet=!0}else{if(isNaN(e))return a;m(this.domNode,"borderWidth",e+f),this._borderLeftWidth=this._borderRightWidth=this._borderTopWidth=this._borderBottomWidth=e,this._borderSet=!0}return e},post:h,value:0},bottom:y,bubbleParent:!0,center:y,color:{set:function(e){return m(this.domNode,"color",e)}},enabled:{post:"_doBackground",set:function(e){return this._focus.node.disabled=!e,e},value:!0},focusable:{value:!1,set:function(e){return t.attr[e?"set":"remove"](this._focus.node,"tabindex",0),e}},_minHeight:y,_maxHeight:y,height:y,left:y,opacity:{set:function(e){return m(this.domNode,"opacity",e)}},visible:{set:function(e,a){return e=!!e,e!==a&&(!e&&(this._lastDisplay=o.get(this.domNode,"display")),m(this.domNode,"display",e?this._lastDisplay||"":"none"),e&&void 0!==a&&this._triggerLayout()),e}},right:y,touchEnabled:{set:function(e){return this._setTouchEnabled(e),e},value:!0},top:y,transform:{set:function(e){return m(this.domNode,"transform",e&&e.toCSS()),this._curTransform=e}},_minWidth:y,_maxWidth:y,width:y,zIndex:y}})});