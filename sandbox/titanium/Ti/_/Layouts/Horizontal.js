define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,a,t,i,n){var s=n.isDef,o=Math.round,r=Math.floor,_=Math.ceil;return a("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,a,n,s,l){var d,c,u,p,m,g,k,b,h,y,f,v,w,z,S,j,P,A,T,I,x={width:0,height:0},M=e._children,N=0,D="px",C=0,B=0,W=[[]],U=[],F=[],E=0,L=M.length,V=this._measureNode;for(N=0;L>N;N++)d=e._children[N],d._alive&&d.domNode?(d._measuredRunningWidth=B,d._markedForLayout&&((d._preLayout&&d._preLayout(a,n,s,l)||d._needsMeasuring)&&V(d,d,d._layoutCoefficients,this),u=d._layoutCoefficients,p=u.width,m=u.height,g=u.sandboxWidth,h=u.left,f=p.x1*a+p.x2*(a-B)+p.x3,v=0===m.x2?m.x1*n+m.x3:0/0,isNaN(f)||isNaN(m.x1)?(y=d._getContentSize?d._getContentSize(f,v):d._layout._doLayout(d,isNaN(f)?a:f-d._borderLeftWidth-d._borderRightWidth,isNaN(v)?n:v-d._borderTopWidth-d._borderBottomWidth,isNaN(f),isNaN(v)),isNaN(f)&&(f=y.width+d._borderLeftWidth+d._borderRightWidth),isNaN(m.x1)&&(v=y.height+d._borderTopWidth+d._borderBottomWidth),d._childrenLaidOut=!0,0===m.x2||isNaN(m.x2)||(t.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),d._childrenLaidOut=!1)):d._childrenLaidOut=!1,d._measuredWidth=f,d._measuredHeight=v,z=d._measuredSandboxWidth=g.x1*a+g.x2+f,S=h.x1*a+h.x2+B,!s&&r(z+B)>_(a)&&(W.push([]),S-=B,B=0),d._measuredLeft=S,W[W.length-1].push(d),B+=z),B>x.width&&(x.width=B)):this.handleInvalidState(d,e);for(L=W.length,N=0;L>N;N++){for(P=W[N],A=0,T=P.length,c=0;T>c;c++)d=P[c],d._markedForLayout&&(u=d._layoutCoefficients,b=u.top,m=u.height,k=u.sandboxHeight,v=d._measuredHeight,isNaN(v)&&(d._measuredHeight=v=m.x1*n+m.x2*(n-C)+m.x3),d._childrenLaidOut||(f=d._measuredWidth,d._childrenLaidOut=!0,d._layout._doLayout(d,isNaN(f)?a:f-d._borderLeftWidth-d._borderRightWidth,isNaN(v)?n:v-d._borderTopWidth-d._borderBottomWidth,isNaN(f),isNaN(v))),0!==b.x2?(F.push(d),j=C):d._measuredTop=j=b.x1*n+b.x3*v+b.x4+C,d._measuredSandboxHeight=w=k.x1*n+k.x2+v+j-C,w>A&&(A=w));U.push(A),C+=A}for(C=0,L=W.length,N=0;L>N;N++){for(P=W[N],A=U[N],T=P.length,c=0;T>c;c++)d=P[c],d._measuredRunningHeight=C,d._measuredRowHeight=A,~F.indexOf(d)&&d._markedForLayout&&(v=d._measuredHeight,b=d._layoutCoefficients.top,d._measuredTop=b.x1*n+b.x2*A+b.x3*v+b.x4+C);C+=A}if(x.height=C,!l)switch(this._defaultVerticalAlignment){case"end":E=n-C;case"center":E/=2}for(L=M.length,N=0;L>N;N++)d=M[N],d._markedForLayout&&(i._elementLayoutCount++,d=M[N],I=d.domNode.style,I.zIndex=d.zIndex,I.left=o(d._measuredLeft)+D,I.top=o(d._measuredTop)+D,I.width=o(d._measuredWidth-d._borderLeftWidth-d._borderRightWidth)+D,I.height=o(d._measuredHeight-d._borderTopWidth-d._borderBottomWidth)+D,d._markedForLayout=!1,d.fireEvent("postlayout"));return this._computedSize=x},_getWidth:function(e,a){return!s(a)&&(a=e._defaultWidth),a===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:a},_getHeight:function(e,a){return!s(a)&&(a=e._defaultHeight),a===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._height)===i.SIZE?i.SIZE:i.FILL:i.FILL:a},_isDependentOnParent:function(e){var a=e._layoutCoefficients;return!isNaN(a.width.x1)&&0!==a.width.x1||!isNaN(a.width.x2)&&0!==a.width.x2||!isNaN(a.height.x1)&&0!==a.height.x1||!isNaN(a.height.x2)&&0!==a.height.x2||0!==a.sandboxWidth.x1||0!==a.sandboxHeight.x1||0!==a.left.x1||0!==a.top.x1},_doAnimationLayout:function(e,a){var t=e._parent._measuredWidth,i=e._parent._measuredHeight,n=e._measuredHeight,s=e._measuredRunningWidth,o=e._measuredRunningHeight,r=e._measuredRowHeight;return{width:a.width.x1*t+a.width.x2*(t-s)+a.width.x3,height:a.height.x1*i+a.height.x2*(i-o)+a.height.x3,left:a.left.x1*t+a.left.x2+s,top:a.top.x1*i+a.top.x2*r+a.top.x3*n+a.top.x4+o}},_measureNode:function(e,a,t,n){e._needsMeasuring=!1;var s,o,r,_,l=n.getValueType,d=n.computeValue,c=n._getWidth(e,a.width),u=l(c),p=d(c,u),m=n._getHeight(e,a.height),g=l(m),k=d(m,g),b=a.left,h=l(b),y=d(b,h),f=a.right,v=l(f),w=d(f,v),z=a.top,S=l(z),j=d(z,S),P=a.bottom,A=l(P),T=d(P,A),I=t.width,x=t.height,M=t.sandboxWidth,N=t.sandboxHeight,D=t.left,C=t.top;if(s=o=r=0,u===i.SIZE?s=o=r=0/0:u===i.FILL?(o=1,"%"===h&&(s=-y),"#"===h&&(r=-y),"%"===v&&(s=-w),"#"===v&&(r=-w)):"%"===u?s=p:"#"===u&&(r=p),I.x1=s,I.x2=o,I.x3=r,s=o=0,"%"===h&&(s=y),"#"===h&&(o=y),"%"===v&&(s+=w),"#"===v&&(o+=w),M.x1=s,M.x2=o,s=o=r=0,g===i.SIZE?s=o=r=0/0:g===i.FILL?(o=1,"%"===S&&(s=-j),"#"===S&&(r=-j)):"%"===g?s=k:"#"===g&&(r=k),x.x1=s,x.x2=o,x.x3=r,N.x1="%"===A?T:0,N.x2="#"===A?T:0,D.x1="%"===h?y:0,D.x2="#"===h?y:0,s=o=r=_=0,"%"===S)s=j;else if("#"===S)_=j;else if("%"===A)s=1-T,r=-1;else if("#"===A)s=1,r=-1,_=-T;else switch(n._defaultRowAlignment){case"center":o=.5,r=-.5;break;case"end":o=1,r=-1}C.x1=s,C.x2=o,C.x3=r,C.x4=_},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});