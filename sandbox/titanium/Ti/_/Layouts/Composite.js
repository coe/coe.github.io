define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,a,t,i){var n=i.isDef,s="px",o=Math.round;return a("Ti._.Layouts.Composite",e,{_doLayout:function(e,a,i,n,r){var _,l,d,c,u,p,m,g,k,b,h,y,f,v,w,z,S,j,P={width:0,height:0},A=e._children,T=0,I=[],x=[],M=A.length,D=this._measureNode;for(T=0;M>T;T++)_=e._children[T],_._alive&&_.domNode?(_._markedForLayout&&((_._preLayout&&_._preLayout(a,i,n,r)||_._needsMeasuring)&&D(_,_,_._layoutCoefficients,this),l=_._layoutCoefficients,d=l.width,k=l.minWidth,c=l.height,b=l.minHeight,u=l.sandboxWidth,p=l.sandboxHeight,g=l.left,m=l.top,y=d.x1*a+d.x2,void 0!==k.x1&&(y=Math.max(y,k.x1*a+k.x2)),f=c.x1*i+c.x2,void 0!==b.x1&&(f=Math.max(f,b.x1*i+b.x2)),h=_._getContentSize?_._getContentSize(y,f):_._layout._doLayout(_,isNaN(y)?a:y-_._borderLeftWidth-_._borderRightWidth,isNaN(f)?i:f-_._borderTopWidth-_._borderBottomWidth,isNaN(y),isNaN(f)),isNaN(y)&&(y=h.width+_._borderLeftWidth+_._borderRightWidth,void 0!==k.x1&&(y=Math.max(y,k.x1*a+k.x2))),isNaN(f)&&(f=h.height+_._borderTopWidth+_._borderBottomWidth,void 0!==b.x1&&(f=Math.max(f,b.x1*i+b.x2))),n&&0!==g.x1?I.push(_):z=g.x1*a+g.x2*y+g.x3,r&&0!==m.x1?x.push(_):S=m.x1*i+m.x2*f+m.x3,_._measuredSandboxWidth=w=u.x1*i+u.x2+y+(isNaN(z)?0:z),_._measuredSandboxHeight=v=p.x1*i+p.x2+f+(isNaN(S)?0:S),_._measuredWidth=y,_._measuredHeight=f,_._measuredLeft=z,_._measuredTop=S),_._measuredSandboxWidth>P.width&&(P.width=_._measuredSandboxWidth),_._measuredSandboxHeight>P.height&&(P.height=_._measuredSandboxHeight)):this.handleInvalidState(_,e);for(M=I.length,T=0;M>T;T++)_=I[T],g=_._layoutCoefficients.left,u=_._layoutCoefficients.sandboxWidth,_._measuredLeft=z=g.x1*P.width+g.x2*y+g.x3,_._measuredSandboxWidth=w=u.x1*i+u.x2+_._measuredWidth+z,w=_._measuredSandboxWidth,w>P.width&&(P.width=w);for(M=x.length,T=0;M>T;T++)_=x[T],m=_._layoutCoefficients.top,p=_._layoutCoefficients.sandboxHeight,_._measuredTop=S=m.x1*P.height+m.x2*f+m.x3,_._measuredSandboxHeight=v=p.x1*i+p.x2+_._measuredHeight+S,v=_._measuredSandboxHeight,v>P.height&&(P.height=v);for(M=A.length,T=0;M>T;T++)_=A[T],_._markedForLayout&&(t._elementLayoutCount++,j=_.domNode.style,j.zIndex=_.zIndex,j.left=o(_._measuredLeft)+s,j.top=o(_._measuredTop)+s,j.width=o(_._measuredWidth-_._borderLeftWidth-_._borderRightWidth)+s,j.height=o(_._measuredHeight-_._borderTopWidth-_._borderBottomWidth)+s,_._markedForLayout=!1,_.fireEvent("postlayout"));return this._computedSize=P},_getWidth:function(e,a){return!n(a)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(a=e._defaultWidth),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_getHeight:function(e,a){return!n(a)&&2>n(e.top)+n(e.center&&e.center.y)+n(e.bottom)&&(a=e._defaultHeight),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_isDependentOnParent:function(e){var a=e._layoutCoefficients;return!isNaN(a.width.x1)&&0!==a.width.x1||!isNaN(a.height.x1)&&0!==a.height.x1||0!==a.left.x1||0!==a.top.x1},_doAnimationLayout:function(e,a){var t=e._parent._measuredWidth,i=e._parent._measuredHeight,n=a.width.x1*t+a.width.x2,s=a.height.x1*i+a.height.x2;return{width:n,height:s,left:a.left.x1*t+a.left.x2*n+a.left.x3,top:a.top.x1*i+a.top.x2*s+a.top.x3}},_measureNode:function(e,a,i,n){e._needsMeasuring=!1;for(var s,o,r,_,l,d,c,u,p,m,g,k,b,h=n.getValueType,y=n.computeValue,f=n._getWidth(e,a.width),v=h(f),w=y(f,v),z=a._minWidth,S=h(z),j=y(z,S),P=n._getHeight(e,a.height),A=h(P),T=y(P,A),I=a._minHeight,x=h(I),M=y(I,x),D=a.left,N=h(D),C=y(D,N),B=a.center&&a.center.x,W=h(B),U=y(B,W),F=a.right,E=h(F),L=y(F,E),V=a.top,O=h(V),q=y(V,O),K=a.center&&a.center.y,R=h(K),G=y(K,R),H=a.bottom,Z=h(H),Y=y(H,Z),J=i.sandboxWidth,$=i.sandboxHeight,X=[[v,w,N,C,W,U,E,L],[A,T,O,q,R,G,Z,Y]],Q=0;2>Q;Q++)_=X[Q],l=_[0],d=_[1],c=_[2],u=_[3],p=_[4],m=_[5],g=_[6],k=_[7],s=o=0,l===t.SIZE?s=o=0/0:l===t.FILL?(s=1,"%"===c?s-=u:"#"===c?o=-u:"%"===g?s-=k:"#"===g&&(o=-k)):"%"===l?s=d:"#"===l?o=d:"%"===c?"%"===p?s=2*(m-u):"#"===p?(s=-2*u,o=2*m):"%"===g?s=1-u-k:"#"===g&&(s=1-u,o=-k):"#"===c?"%"===p?(s=2*m,o=-2*u):"#"===p?o=2*(m-u):"%"===g?(s=1-k,o=-u):"#"===g&&(s=1,o=-k-u):"%"===p?"%"===g?s=2*(k-m):"#"===g&&(s=-2*m,o=2*k):"#"===p&&("%"===g?(s=2*k,o=-2*m):"#"===g&&(o=2*(k-m))),i[b=0===Q?"width":"height"].x1=s,i[b].x2=o;X={minWidth:[S,j,N,C,W,U,E,L],minHeight:[x,M,O,q,R,G,Z,Y]};for(Q in X)_=X[Q],l=_[0],d=_[1],c=_[2],u=_[3],p=_[4],m=_[5],g=_[6],k=_[7],s=o=r=0,l===t.SIZE?s=o=0/0:l===t.FILL?(s=1,"%"===c?s-=u:"#"===c?o=-u:"%"===g?s-=k:"#"===g&&(o=-k)):"%"===l?s=d:"#"===l?o=d:s=o=r=void 0,i[Q].x1=s,i[Q].x2=o,i[Q].x3=r;for(X=[[N,C,W,U,E,L],[O,q,R,G,Z,Y]],Q=0;2>Q;Q++){if(_=X[Q],c=_[0],u=_[1],p=_[2],m=_[3],g=_[4],k=_[5],s=o=r=0,"%"===c)s=u;else if("#"===c)r=u;else if("%"===p)s=m,o=-.5;else if("#"===p)o=-.5,r=m;else if("%"===g)s=1-k,o=-1;else if("#"===g)s=1,o=-1,r=-k;else switch("left"===Q?n._defaultHorizontalAlignment:n._defaultVerticalAlignment){case"center":s=.5,o=-.5;break;case"end":s=1,o=-1}i[b=0===Q?"left":"top"].x1=s,i[b].x2=o,i[b].x3=r}J.x1="%"===E?L:0,J.x2="#"===E?L:0,$.x1="%"===Z?Y:0,$.x2="#"===Z?Y:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"center"})});