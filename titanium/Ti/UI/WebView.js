define(["Ti/_/declare","Ti/UI/View","Ti/_/dom","Ti/_/event","Ti/_/lang","Ti/_/text!Ti/_/UI/WebViewBridge.js","Ti/App","Ti/API","Ti/UI","Ti/_/style"],function(e,t,i,r,o,n,a,s,l,u){var d=require.on;return e("Ti.UI.WebView",t,{constructor:function(){a.addEventListener(this.widgetId+":unload",o.hitch(this,function(){this._loading(1)})),this.backgroundColor="#fff",u.set(this.domNode,{overflow:"auto",overflowScrolling:"touch"})},destroy:function(){a.removeEventListener(this.widgetId+":unload"),this._destroy(),Widget.prototype.destroy.apply(this,arguments)},_destroy:function(){this._iframe&&(r.off(this._iframeHandles),i.destroy(this._iframe))},_createIFrame:function(){if(this._parent){this._destroy(),this._loading(1);var e=this.url||"",t=e.match(/(https?)\:\/\/([^\:\/]*)(:?\d*)(.*)/),r=window.location,o=!t||t[0]+":"===r.protocol&&t[1]+t[2]===window.location.host,a=this._iframe=i.create("iframe",{frameborder:0,marginwidth:0,marginheight:0,hspace:0,vspace:0,scrolling:this.showScrollbars?"auto":"no",src:e||require.toUrl("Ti/_/UI/blank.html"),style:{width:"100%",height:"100%",position:"absolute"}},this.domNode);return this._iframeHandles=[d(a,"load",this,function(){var e,t,i,r=Math.max(0|o,0),l=a.contentWindow;if(-1!==r)o=-1;else for(e in l){r++;break}r>0?(t=l.location.href,this.evalJS(n.replace("WEBVIEW_ID",this.widgetId+":unload")),(i=this.__values__.properties.html)&&this._setContent(i)):s.warn("Unable to inject WebView bridge into cross-domain URL, ignore browser security message"),this._loading(),this.fireEvent("load",{url:t?this.__values__.properties.url=t:this.url})}),d(a,"error",this,function(){this._loading(),this.fireEvent("error",{message:"Page failed to load",url:this.url})})],1}},_setParent:function(){t.prototype._setParent.apply(this,arguments),(this.url||this.html)&&this._createIFrame()},_getWindow:function(){return this._iframe.contentWindow},_getDoc:function(){return this._getWindow().document},_getHistory:function(){return this._getWindow().history},_loading:function(e){this.loading||e&&this.fireEvent("beforeload",{url:this.url}),this.__values__.constants.loading=!!e},canGoBack:function(){return this.url&&!!this._getHistory().length},canGoForward:function(){return this.url&&!!this._getHistory().length},evalJS:function(e){var t=this._getWindow(),i=null;try{i=e&&t&&t.eval&&t.eval(e)}catch(r){}return i},goBack:function(){if(this.canGoBack()){var e=this._getHistory();e&&(this._loading(1),e.go(-1))}},goForward:function(){if(this.canGoForward()){var e=this._getHistory();e&&(this._loading(1),e.go(1))}},reload:function(){var e=this._getWindow();this.url&&e?e.location.href=this.url:this._createIFrame()},stopLoading:function(e){try{this.loading&&e?this._destroy():this._getWindow().stop()}catch(t){}this._loading()},_defaultWidth:l.FILL,_defaultHeight:l.FILL,_getContentSize:function(){return{width:this._iframe?this._iframe.clientWidth:0,height:this._iframe?this._iframe.clientHeight:0}},_setContent:function(e){try{var t=this._getDoc();t.open(),t.write(e),t.close()}catch(i){}return e},properties:{data:{set:function(e){var t=e;switch(t&&t.declaredClass){case"Ti.Filesystem.File":t=t.read();case"Ti.Blob":t=t.toString();default:this.html=t}return e}},html:{get:function(e){var t=this._iframe&&this._getDoc();return void 0===e&&t?t.documentElement.innerHTML:e},post:function(e){var t=this.__values__.properties;t.data=void 0,t.url=void 0,this._createIFrame()&&this._setContent(e)}},showScrollbars:{set:function(e){return this._iframe&&i.attr.set(this._iframe,"scrolling",e?"auto":"no"),e},value:!0},url:{post:function(){var e=this.__values__.properties;e.data=void 0,e.html=void 0,this._createIFrame()}}},constants:{loading:!1}})});