define(["Ti/_/declare","Ti/_/UI/FontWidget","Ti/_/dom","Ti/UI","Ti/_/has","Ti/_/style","Ti/_/lang"],function(e,t,i,r,o,n,a){var s=n.set,l=15,u=require.on;return e("Ti.UI.PickerColumn",t,{constructor:function(){var e=this,t=o("touch")?"touchend":"click",n=e.domNode,a=e.__values__.constants.rows=[],s=e._upArrow=i.create("div",{className:"TiUIElementGradient",style:{textAlign:"center",position:"absolute",top:0,height:"40px",left:0,right:0,borderBottom:"1px solid #666",fontSize:"28px",cursor:"pointer"},innerHTML:"∧"},n),l=e._titleContainer=i.create("div",{style:{position:"absolute",top:"50%",height:"1em",width:"100%",marginTop:"-0.5em",textAlign:"center"}},n),d=i.create("div",{style:{position:"absolute",top:"40px",bottom:"40px",width:"100%"}},n),c=e._downArrow=i.create("div",{className:"TiUIElementGradient",innerHTML:"∨",style:{textAlign:"center",position:"absolute",bottom:"0px",height:"40px",width:"100%",borderTop:"1px solid #666",fontSize:"28px",cursor:"pointer"}},n);e._addStyleableDomNode(l),this._handles=[u(s,t,function(){var t=a.indexOf(e.selectedRow);t>0?e.selectedRow=a[t-1]:e.selectedRow=a[a.length-1]}),u(d,t,function(){var t=r.createWindow(),i=r.createView({backgroundColor:"#000",opacity:0,left:0,top:0,right:0,bottom:0}),o=r.createView({width:"75%",height:r.SIZE,backgroundColor:"#fff",layout:r._LAYOUT_CONSTRAINING_VERTICAL,borderRadius:3,opacity:0}),n=0,s=0,l=a.map(function(t){var i=t===e.selectedRow;return i&&(n=parseInt(s++)),{title:t.title,hasCheck:i}}),u=r.createTableView({left:5,right:5,top:5,height:l.length<10?r.SIZE:"70%",data:l}),d=r.createButton({left:5,top:5,right:5,title:"Cancel"});u.addEventListener("singletap",function(i){i.index in a&&(e.selectedRow=a[i.index]),t.close()}),d.addEventListener("singletap",function(){t.close()}),t._add(i),t._add(o),o._add(u),o.add(d),o._add(r.createView({height:"5px"})),t.open(),setTimeout(function(){i.animate({opacity:.5,duration:200},function(){o.animate({opacity:1,duration:200},function(){u.scrollToIndex(n)})})},30)}),u(c,t,function(){var t=a.indexOf(e.selectedRow);t<a.length-1?e.selectedRow=a[t+1]:e.selectedRow=a[0]})]},destroy:function(){event.off(this._handles),t.prototype.destroy.apply(this,arguments)},_setCorners:function(e,t,i){s(this._upArrow,{borderTopLeftRadius:e?i:"0px",borderTopRightRadius:t?i:"0px"}),s(this._downArrow,{borderBottomLeftRadius:e?i:"0px",borderBottomRightRadius:t?i:"0px"}),this.borderWidth=[0,t?0:1,0,0],this.borderColor="#666"},_defaultWidth:r.SIZE,_defaultHeight:r.SIZE,_preLayout:function(){return this._updateContentWidth(),this._parentPicker&&this._parentPicker._updateColumnHeights(),!0},_getContentSize:function(){var e=this._titleContainer;return text=e.innerHTML,{width:Math.max(this._widestRowWidth+l,100),height:this._tallestRowHeight+l+this._upArrow.clientHeight+this._downArrow.clientHeight}},_widestRowWidth:0,_tallestRowHeight:0,_updateContentWidth:function(){for(var e,t=0,i=0,r=this.rows.length;r>i;)e=this.rows[i++],t=Math.max(t,e._measureText(e.title,e.domNode).width);this._widestRowWidth!==t&&(this._widestRowWidth=t)},_getTallestRowHeight:function(){for(var e=0,t=0,i=this.rows.length;i>t;t++){var r=this.rows[t];e=Math.max(e,r._measureText(r.title,r.domNode).height)}return e},_setTallestRowHeight:function(e){this._tallestRowHeight!==e&&(this._tallestRowHeight=e,this._triggerLayout())},addRow:function(e){this.rows.push(e),e._parentColumn=this,this._updateContentWidth(),this._parentPicker&&this._parentPicker._updateColumnHeights(),this.selectedRow||(this.selectedRow=e),this._publish(e)},removeRow:function(e){var t=this.rows.indexOf(e);-1!==t&&(this.rows.splice(t,1),e._parentColumn=void 0,this._updateContentWidth(),this._parentPicker&&this._parentPicker._updateColumnHeights(),this.selectedRow===e&&(this.selectedRow=this.rows[0])),this._unpublish(e)},constants:{rowCount:{get:function(){return this.rows.length}},rows:void 0},properties:{selectedRow:{set:function(e){if(e){var t=this.rows.indexOf(e);if(-1===t)return;this.font=e.font,this.color=a.val(e.color,""),this._titleContainer.innerHTML=e.title,this._hasSizeDimensions()&&this._triggerLayout()}else this.font=void 0,this.color=void 0,this._titleContainer.innerHTML="",this._hasSizeDimensions()&&this._triggerLayout();return e},post:function(e){this.fireEvent("change",{column:this,rowIndex:this.rows.indexOf(e),row:e,value:e&&e.title})}}}})});