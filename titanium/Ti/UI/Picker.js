define(["Ti/_/declare","Ti/_/event","Ti/_/has","Ti/UI/View","Ti/_/UI/Widget","Ti/UI","Ti/_/lang","Ti/_/dom","Ti/_/ready"],function(e,t,i,r,o,n,a,s,l){function u(e,t){if(e){if("DateTime"===t)return new Date(e);var i,r=new Date;return"Date"===t&&(i=e.match(/^(?:(\d+)\/(\d+)\/(\d+))|(?:(\d+)-(\d+)-(\d+))$/),r.setYear(i[1]?i[3]:i[4]),r.setMonth(i[1]?i[1]-1:i[5]-1),r.setDate(i[1]?i[2]:i[6])),"Time"===t&&(i=e.match(/^(\d+)\:(\d+)\s*(am|pm)?$/i),r.setHours(i[3]&&"pm"==i[3].toLowerCase()&&~~i[1]<12?~~i[1]+12:i[1]),r.setMinutes(i[2]),r.setSeconds(0)),r}}var d=require.is,c=6,h=s.unitize(c),p={},f=require.on,g=e(o,{constructor:function(){function e(){var e=r.value,i=u(e,o.type);t!==e&&i&&(t=e,o.picker.fireEvent("change",{value:i}))}var t,r=this._input=s.create("input",{style:{left:h,top:h,right:h,bottom:h,position:"absolute"}},this.domNode),o=this;o._handles=[f(r,i("touch")?"touchend":"click",e),f(r,"change",e),f(r,"blur",e)]},destroy:function(){t.off(this._handles),o.prototype.destroy.apply(this,arguments)},_getContentSize:function(){return p[this.type]},properties:{type:{set:function(e){return this._input.type=e}},min:{set:function(e){return this._input.min=a.val(e,""),e}},max:{set:function(e){return this._input.max=a.val(e,""),e}},value:{get:function(){return u(this._input.value,this.type)},set:function(e){try{this._input.valueAsDate=e}catch(t){}}}}});return g.prototype.declaredClass="DateTimeInput",l(function(){var e=s.create("input",{style:{height:n.SIZE,width:n.SIZE}},document.body);["Date","Time","DateTime"].forEach(function(t){try{e.type=t}catch(i){}p[t]={width:e.clientWidth+2*c,height:e.clientHeight+2*c}}),s.detach(e)}),e("Ti.UI.Picker",r,{constructor:function(){this.layout="constrainingHorizontal",this._columns=[],this._getBorderFromCSS()},_currentColumn:null,_addColumn:function(e){this._columns.push(e),e._parentPicker=this;for(var t=0,i=this._columns.length,r=this.width===n.SIZE?n.SIZE:100/i+"%",o=this.height===n.SIZE?n.SIZE:"100%";i>t;t++)e=this._columns[t],e.width=r,e.height=o,e._setCorners(0===t,t===i-1,h);e._pickerChangeEventListener=a.hitch(this,function(e){var t={column:e.column,columnIndex:this._columns.indexOf(e.column),row:e.row,rowIndex:e.rowIndex};if(this.type===n.PICKER_TYPE_PLAIN){var i=[];for(var r in this._columns){var o=this._columns[r].selectedRow;o&&i.push(o.title)}t.selectedValue=i}this.fireEvent("change",t)}),e.addEventListener("change",e._pickerChangeEventListener),this._add(e),this._publish(e)},_updateColumnHeights:function(){var e,t=0;for(e in this._columns)t=Math.max(t,this._columns[e]._getTallestRowHeight());for(e in this._columns)this._columns[e]._setTallestRowHeight(t)},_defaultWidth:n.SIZE,_defaultHeight:n.SIZE,add:function(e){if(d(e,"Array"))for(var t in e)this.add(e[t]);else a.isDef(e.declaredClass)&&("Ti.UI.PickerColumn"===e.declaredClass?this._addColumn(e):"Ti.UI.PickerRow"===e.declaredClass&&(null===this._currentColumn&&this._addColumn(this._currentColumn=n.createPickerColumn()),this._currentColumn.addRow(e)))},destroy:function(){this._dateTimeInput&&this._dateTimeInput.destroy(),o.prototype.destroy.apply(this,arguments)},getSelectedRow:function(e){var t=this._columns[e];return t&&t.selectedRow},setSelectedRow:function(e,t){var i=this._columns[e];i&&(i.selectedRow=i.rows[t])},properties:{columns:{get:function(){return this._columns},set:function(e){this._removeAllChildren();for(var t in this._columns){var i=this._columns[t];i.removeEventListener(i._pickerChangeEventListener),i._parentPicker=void 0}this._columns=[],e&&this.add(e)}},maxDate:{set:function(e){return this._dateTimeInput&&(this._dateTimeInput.max=e),e}},minDate:{set:function(e){return this._dateTimeInput&&(this._dateTimeInput.min=e),e}},type:{set:function(e,t){function i(e){var t=r._dateTimeInput=new g({type:e,width:n.INHERIT,height:n.INHERIT,picker:r});t.addEventListener("change",function(e){r.__values__.properties.value=e.value,r.fireEvent("change",e)}),t.min=r.min,t.max=r.max,r._add(t)}var r=this;if(e!==t)switch(this.columns=void 0,this._dateTimeInput=null,e){case n.PICKER_TYPE_DATE:i("Date");break;case n.PICKER_TYPE_TIME:i("Time");break;case n.PICKER_TYPE_DATE_AND_TIME:i("DateTime")}return e},value:n.PICKER_TYPE_PLAIN},value:{get:function(){return this._dateTimeInput&&this._dateTimeInput.value},set:function(e){return this._dateTimeInput&&(this._dateTimeInput.value=e),e}}}})});