define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,r){var n=r.isDef,o=Math.round;return t("Ti._.Layouts.Vertical",e,{_doLayout:function(e,t,r,n,a){var s,l,u,d,c,h,f,p,g,_,v,T,w,m,U,b={width:0,height:0},I=e._children,E=0,y="px",C=[],x=0,S=I.length,N=this._measureNode;for(E=0;S>E;E++)s=e._children[E],s._alive&&s.domNode?(s._measuredRunningHeight=x,s._markedForLayout&&((s._preLayout&&s._preLayout(t,r,n,a)||s._needsMeasuring)&&N(s,s,s._layoutCoefficients,this),l=s._layoutCoefficients,u=l.width,d=l.height,c=l.sandboxWidth,h=l.sandboxHeight,p=l.left,f=l.top,_=u.x1*t+u.x2,v=d.x1*r+d.x2*(r-x)+d.x3,g=s._getContentSize?s._getContentSize(_,v):s._layout._doLayout(s,isNaN(_)?t:_-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?r:v-s._borderTopWidth-s._borderBottomWidth,isNaN(_),isNaN(v)),isNaN(_)&&(_=g.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=g.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=_,s._measuredHeight=v,n&&0!==p.x1?C.push(s):(m=s._measuredLeft=p.x1*t+p.x2*_+p.x3,w=s._measuredSandboxWidth=c.x1*t+c.x2+_+(isNaN(m)?0:m)),s._measuredTop=f.x1*r+f.x2+x,T=s._measuredSandboxHeight=h.x1*r+h.x2+v),s._measuredSandboxWidth>b.width&&(b.width=s._measuredSandboxWidth),x=b.height+=s._measuredSandboxHeight):this.handleInvalidState(s,e);for(S=C.length,E=0;S>E;E++)s=C[E],c=s._layoutCoefficients.sandboxWidth,w=s._measuredSandboxWidth=c.x1*t+c.x2+s._measuredWidth,w>b.width&&(b.width=w);for(E=0;S>E;E++)s=C[E],p=s._layoutCoefficients.left,c=s._layoutCoefficients.sandboxWidth,_=s._measuredWidth,w=s._measuredSandboxWidth,w>b.width&&(b.width=w),m=s._measuredLeft=p.x1*b.width+p.x2*_+p.x3,s._measuredSandboxWidth+=isNaN(m)?0:m;for(S=I.length,E=0;S>E;E++)s=I[E],s._markedForLayout&&(i._elementLayoutCount++,s=I[E],U=s.domNode.style,U.zIndex=s.zIndex,U.left=o(s._measuredLeft)+y,U.top=o(s._measuredTop)+y,U.width=o(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+y,U.height=o(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+y,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=b},_getWidth:function(e,t){return!n(t)&&n(e.left)+n(e.center&&e.center.x)+n(e.right)<2&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:t},_getHeight:function(e,t){return!n(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,r=e._parent._measuredHeight,n=e._measuredRunningHeight,o=t.width.x1*i+t.width.x2;return{width:o,height:t.height.x1*r+t.height.x2*(r-n)+t.height.x3,left:t.left.x1*i+t.left.x2*o+t.left.x3,top:t.top.x1*r+t.top.x2+n}},_measureNode:function(e,t,r,n){e._needsMeasuring=!1;var o,a,s,l=n.getValueType,u=n.computeValue,d=n._getWidth(e,t.width),c=l(d),h=u(d,c),f=n._getHeight(e,t.height),p=l(f),g=u(f,p),_=t.left,v=l(_),T=u(_,v),w=t.center&&t.center.x,m=l(w),U=u(w,m),b=t.right,I=l(b),E=u(b,I),y=t.top,C=l(y),x=u(y,C),S=t.bottom,N=l(S),L=u(S,N),A=r.width,k=r.height,O=r.sandboxWidth,R=r.sandboxHeight,P=r.left,M=r.top;if(o=a=0,c===i.SIZE?o=a=NaN:c===i.FILL?(o=1,"%"===v?o-=T:"#"===v?a=-T:"%"===I?o-=E:"#"===I&&(a=-E)):"%"===c?o=h:"#"===c?a=h:"%"===v?"%"===m?o=2*(U-T):"#"===m?(o=-2*T,a=2*U):"%"===I?o=1-T-E:"#"===I&&(o=1-T,a=-E):"#"===v?"%"===m?(o=2*U,a=-2*T):"#"===m?a=2*(U-T):"%"===I?(o=1-E,a=-T):"#"===I&&(o=1,a=-E-T):"%"===m?"%"===I?o=2*(E-U):"#"===I&&(o=-2*U,a=2*E):"#"===m&&("%"===I?(o=2*E,a=-2*U):"#"===I&&(a=2*(E-U))),A.x1=o,A.x2=a,O.x1="%"===I?E:0,O.x2="#"===I?E:0,o=a=s=0,p===i.SIZE?o=a=s=NaN:p===i.FILL?(a=1,"%"===C&&(o=-x),"#"===C&&(s=-x),"%"===N&&(o=-L),"#"===N&&(s=-L)):"%"===p?o=g:"#"===p&&(s=g),k.x1=o,k.x2=a,k.x3=s,o=a=0,"%"===C&&(o=x),"#"===C&&(a=x),"%"===N&&(o+=L),"#"===N&&(a+=L),R.x1=o,R.x2=a,o=a=s=0,"%"===v)o=T;else if("#"===v)s=T;else if("%"===m)o=U,a=-.5;else if("#"===m)a=-.5,s=U;else if("%"===I)o=1-E,a=-1;else if("#"===I)o=1,a=-1,s=-E;else switch(n._defaultHorizontalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}P.x1=o,P.x2=a,P.x3=s,M.x1="%"===C?x:0,M.x2="#"===C?x:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});