define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,r){var n=r.isDef,o="px",a=Math.round;return t("Ti._.Layouts.Composite",e,{_doLayout:function(e,t,r,n,s){var l,u,d,c,h,p,f,g,_,v,T,w,U,m,b,I,E,y,C={width:0,height:0},S=e._children,x=0,L=[],A=[],N=S.length,k=this._measureNode;for(x=0;N>x;x++)l=e._children[x],l._alive&&l.domNode?(l._markedForLayout&&((l._preLayout&&l._preLayout(t,r,n,s)||l._needsMeasuring)&&k(l,l,l._layoutCoefficients,this),u=l._layoutCoefficients,d=u.width,_=u.minWidth,c=u.height,v=u.minHeight,h=u.sandboxWidth,p=u.sandboxHeight,g=u.left,f=u.top,w=d.x1*t+d.x2,void 0!==_.x1&&(w=Math.max(w,_.x1*t+_.x2)),U=c.x1*r+c.x2,void 0!==v.x1&&(U=Math.max(U,v.x1*r+v.x2)),T=l._getContentSize?l._getContentSize(w,U):l._layout._doLayout(l,isNaN(w)?t:w-l._borderLeftWidth-l._borderRightWidth,isNaN(U)?r:U-l._borderTopWidth-l._borderBottomWidth,isNaN(w),isNaN(U)),isNaN(w)&&(w=T.width+l._borderLeftWidth+l._borderRightWidth,void 0!==_.x1&&(w=Math.max(w,_.x1*t+_.x2))),isNaN(U)&&(U=T.height+l._borderTopWidth+l._borderBottomWidth,void 0!==v.x1&&(U=Math.max(U,v.x1*r+v.x2))),n&&0!==g.x1?L.push(l):I=g.x1*t+g.x2*w+g.x3,s&&0!==f.x1?A.push(l):E=f.x1*r+f.x2*U+f.x3,l._measuredSandboxWidth=b=h.x1*r+h.x2+w+(isNaN(I)?0:I),l._measuredSandboxHeight=m=p.x1*r+p.x2+U+(isNaN(E)?0:E),l._measuredWidth=w,l._measuredHeight=U,l._measuredLeft=I,l._measuredTop=E),l._measuredSandboxWidth>C.width&&(C.width=l._measuredSandboxWidth),l._measuredSandboxHeight>C.height&&(C.height=l._measuredSandboxHeight)):this.handleInvalidState(l,e);for(N=L.length,x=0;N>x;x++)l=L[x],g=l._layoutCoefficients.left,h=l._layoutCoefficients.sandboxWidth,l._measuredLeft=I=g.x1*C.width+g.x2*w+g.x3,l._measuredSandboxWidth=b=h.x1*r+h.x2+l._measuredWidth+I,b=l._measuredSandboxWidth,b>C.width&&(C.width=b);for(N=A.length,x=0;N>x;x++)l=A[x],f=l._layoutCoefficients.top,p=l._layoutCoefficients.sandboxHeight,l._measuredTop=E=f.x1*C.height+f.x2*U+f.x3,l._measuredSandboxHeight=m=p.x1*r+p.x2+l._measuredHeight+E,m=l._measuredSandboxHeight,m>C.height&&(C.height=m);for(N=S.length,x=0;N>x;x++)l=S[x],l._markedForLayout&&(i._elementLayoutCount++,y=l.domNode.style,y.zIndex=l.zIndex,y.left=a(l._measuredLeft)+o,y.top=a(l._measuredTop)+o,y.width=a(l._measuredWidth-l._borderLeftWidth-l._borderRightWidth)+o,y.height=a(l._measuredHeight-l._borderTopWidth-l._borderBottomWidth)+o,l._markedForLayout=!1,l.fireEvent("postlayout"));return this._computedSize=C},_getWidth:function(e,t){return!n(t)&&n(e.left)+n(e.center&&e.center.x)+n(e.right)<2&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:t},_getHeight:function(e,t){return!n(t)&&n(e.top)+n(e.center&&e.center.y)+n(e.bottom)<2&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,r=e._parent._measuredHeight,n=t.width.x1*i+t.width.x2,o=t.height.x1*r+t.height.x2;return{width:n,height:o,left:t.left.x1*i+t.left.x2*n+t.left.x3,top:t.top.x1*r+t.top.x2*o+t.top.x3}},_measureNode:function(e,t,r,n){e._needsMeasuring=!1;for(var o,a,s,l,u,d,c,h,p,f,g,_,v,T=n.getValueType,w=n.computeValue,U=n._getWidth(e,t.width),m=T(U),b=w(U,m),I=t._minWidth,E=T(I),y=w(I,E),C=n._getHeight(e,t.height),S=T(C),x=w(C,S),L=t._minHeight,A=T(L),N=w(L,A),k=t.left,O=T(k),P=w(k,O),R=t.center&&t.center.x,M=T(R),D=w(R,M),W=t.right,q=T(W),B=w(W,q),F=t.top,V=T(F),H=w(F,V),Y=t.center&&t.center.y,j=T(Y),G=w(Y,j),z=t.bottom,X=T(z),Z=w(z,X),K=r.sandboxWidth,J=r.sandboxHeight,$=[[m,b,O,P,M,D,q,B],[S,x,V,H,j,G,X,Z]],Q=0;2>Q;Q++)l=$[Q],u=l[0],d=l[1],c=l[2],h=l[3],p=l[4],f=l[5],g=l[6],_=l[7],o=a=0,u===i.SIZE?o=a=NaN:u===i.FILL?(o=1,"%"===c?o-=h:"#"===c?a=-h:"%"===g?o-=_:"#"===g&&(a=-_)):"%"===u?o=d:"#"===u?a=d:"%"===c?"%"===p?o=2*(f-h):"#"===p?(o=-2*h,a=2*f):"%"===g?o=1-h-_:"#"===g&&(o=1-h,a=-_):"#"===c?"%"===p?(o=2*f,a=-2*h):"#"===p?a=2*(f-h):"%"===g?(o=1-_,a=-h):"#"===g&&(o=1,a=-_-h):"%"===p?"%"===g?o=2*(_-f):"#"===g&&(o=-2*f,a=2*_):"#"===p&&("%"===g?(o=2*_,a=-2*f):"#"===g&&(a=2*(_-f))),r[v=0===Q?"width":"height"].x1=o,r[v].x2=a;$={minWidth:[E,y,O,P,M,D,q,B],minHeight:[A,N,V,H,j,G,X,Z]};for(Q in $)l=$[Q],u=l[0],d=l[1],c=l[2],h=l[3],p=l[4],f=l[5],g=l[6],_=l[7],o=a=s=0,u===i.SIZE?o=a=NaN:u===i.FILL?(o=1,"%"===c?o-=h:"#"===c?a=-h:"%"===g?o-=_:"#"===g&&(a=-_)):"%"===u?o=d:"#"===u?a=d:o=a=s=void 0,r[Q].x1=o,r[Q].x2=a,r[Q].x3=s;for($=[[O,P,M,D,q,B],[V,H,j,G,X,Z]],Q=0;2>Q;Q++){if(l=$[Q],c=l[0],h=l[1],p=l[2],f=l[3],g=l[4],_=l[5],o=a=s=0,"%"===c)o=h;else if("#"===c)s=h;else if("%"===p)o=f,a=-.5;else if("#"===p)a=-.5,s=f;else if("%"===g)o=1-_,a=-1;else if("#"===g)o=1,a=-1,s=-_;else switch("left"===Q?n._defaultHorizontalAlignment:n._defaultVerticalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}r[v=0===Q?"left":"top"].x1=o,r[v].x2=a,r[v].x3=s}K.x1="%"===q?B:0,K.x2="#"===q?B:0,J.x1="%"===X?Z:0,J.x2="#"===X?Z:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"center"})});