define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,r){var n=r.isDef,o=Math.round;return t("Ti._.Layouts.ConstrainingHorizontal",e,{_doLayout:function(e,t,r,n,a){var s,l,u,d,c,h,p,f,g,_,v,T,w,m,U,b,I,E={width:0,height:0},y=e._children,C=0,S="px",x=[],L=0,N=0,A=y.length,k=this._measureNode;for(C=0;A>C;C++)s=e._children[C],s._alive&&s.domNode?s._markedForLayout&&((s._preLayout&&s._preLayout(t,r,n,a)||s._needsMeasuring)&&k(s,s,s._layoutCoefficients,this),l=s._layoutCoefficients,u=l.width,0===u.x2||isNaN(u.x2)?(d=l.height,c=l.sandboxWidth,h=l.sandboxHeight,v=d.x1*r+d.x2,_=u.x1*t+u.x2*(t-L)+u.x3,g=s._getContentSize?s._getContentSize(_,v):s._layout._doLayout(s,isNaN(_)?t:_-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?r:v-s._borderTopWidth-s._borderBottomWidth,isNaN(_),isNaN(v)),isNaN(_)&&(_=g.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=g.height+s._borderTopWidth+s._borderBottomWidth),w=s._measuredSandboxWidth=c.x1*t+c.x2+_,L+=w,s._measuredWidth=_,s._measuredHeight=v):N++):this.handleInvalidState(s,e);for(b=t-L,L=Math.floor(b/N),C=0;A>C;C++)s=e._children[C],s._markedForLayout&&(l=s._layoutCoefficients,u=l.width,0===u.x2||isNaN(u.x2)||(d=l.height,c=l.sandboxWidth,h=l.sandboxHeight,v=d.x1*r+d.x2,_=u.x1*t+u.x2*(A-1>C?L:b-L*(N-1))+u.x3,g=s._getContentSize?s._getContentSize(_,v):s._layout._doLayout(s,isNaN(_)?t:_-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?r:v-s._borderTopWidth-s._borderBottomWidth,isNaN(_),isNaN(v)),isNaN(_)&&(_=g.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=g.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=_,s._measuredHeight=v,w=s._measuredSandboxWidth=c.x1*t+c.x2+_));for(L=0,C=0;A>C;C++)s=e._children[C],s._measuredRunningWidth=L,s._markedForLayout?(l=s._layoutCoefficients,h=l.sandboxHeight,p=l.top,f=l.left,a&&0!==p.x1?x.push(s):(v=s._measuredHeight,U=s._measuredTop=p.x1*r+p.x2*v+p.x3,T=s._measuredSandboxHeight=h.x1*r+h.x2+v+(isNaN(U)?0:U),s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight)),m=s._measuredLeft=f.x1*t+f.x2+L):s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight),L+=s._measuredSandboxWidth;for(E.width=L,A=x.length,C=0;A>C;C++)s=x[C],h=s._layoutCoefficients.sandboxHeight,T=s._measuredSandboxHeight=h.x1*r+h.x2+s._measuredHeight,T>E.height&&(E.height=T);for(C=0;A>C;C++)s=x[C],p=s._layoutCoefficients.top,h=s._layoutCoefficients.sandboxHeight,v=s._measuredHeight,T=s._measuredSandboxHeight,T>E.height&&(E.height=T),U=s._measuredTop=p.x1*E.height+p.x2*v+p.x3,s._measuredSandboxHeight+=isNaN(U)?0:U;for(A=y.length,C=0;A>C;C++)s=y[C],s._markedForLayout&&(i._elementLayoutCount++,s=y[C],I=s.domNode.style,I.zIndex=s.zIndex,I.left=o(s._measuredLeft)+S,I.top=o(s._measuredTop)+S,I.width=o(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+S,I.height=o(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+S,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(e,t){return!n(t)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:t},_getHeight:function(e,t){return!n(t)&&n(e.top)+n(e.center&&e.center.y)+n(e.bottom)<2&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,r=e._parent._measuredHeight,n=e._measuredRunningWidth,o=t.height.x1*r+t.height.x2;return{width:t.width.x1*i+t.width.x2*(i-n)+t.width.x3,height:o,left:t.left.x1*i+t.left.x2+n,top:t.top.x1*r+t.top.x2*o+t.top.x3}},_measureNode:function(e,t,r,n){e._needsMeasuring=!1;var o,a,s,l=n.getValueType,u=n.computeValue,d=n._getWidth(e,t.width),c=l(d),h=u(d,c),p=n._getHeight(e,t.height),f=l(p),g=u(p,f),_=t.left,v=l(_),T=u(_,v),w=t.right,m=l(w),U=u(w,m),b=t.top,I=l(b),E=u(b,I),y=t.center&&t.center.y,C=l(y),S=u(y,C),x=t.bottom,L=l(x),N=u(x,L),A=r.width,k=r.height,O=r.sandboxWidth,R=r.sandboxHeight,P=r.left,M=r.top;if(o=a=0,f===i.SIZE?o=a=NaN:f===i.FILL?(o=1,"%"===I?o-=E:"#"===I?a=-E:"%"===L?o-=N:"#"===L&&(a=-N)):"%"===f?o=g:"#"===f?a=g:"%"===I?"%"===C?o=2*(S-E):"#"===C?(o=-2*E,a=2*S):"%"===L?o=1-E-N:"#"===L&&(o=1-E,a=-N):"#"===I?"%"===C?(o=2*S,a=-2*E):"#"===C?a=2*(S-E):"%"===L?(o=1-N,a=-E):"#"===L&&(o=1,a=-N-E):"%"===C?"%"===L?o=2*(N-S):"#"===L&&(o=-2*S,a=2*N):"#"===C&&("%"===L?(o=2*N,a=-2*S):"#"===L&&(a=2*(N-S))),k.x1=o,k.x2=a,R.x1="%"===L?N:0,R.x2="#"===L?N:0,o=a=s=0,c===i.SIZE?o=a=s=NaN:c===i.FILL?(a=1,"%"===v&&(o=-T),"#"===v&&(s=-T),"%"===m&&(o=-U),"#"===m&&(s=-U)):"%"===c?o=h:"#"===c&&(s=h),A.x1=o,A.x2=a,A.x3=s,o=a=0,"%"===v&&(o=T),"#"===v&&(a=T),"%"===m&&(o+=U),"#"===m&&(a+=U),O.x1=o,O.x2=a,o=a=s=0,"%"===I)o=E;else if("#"===I)s=E;else if("%"===C)o=S,a=-.5;else if("#"===C)a=-.5,s=S;else if("%"===L)o=1-N,a=-1;else if("#"===L)o=1,a=-1,s=-N;else switch(n._defaultVerticalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}M.x1=o,M.x2=a,M.x3=s,P.x1="%"===v?T:0,P.x2="#"===v?T:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});