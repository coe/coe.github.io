define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,t,i,r,n){var o=n.isDef,a=Math.round,s=Math.floor,l=Math.ceil;return t("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,t,n,o,u){var d,c,h,f,p,g,_,v,T,w,m,U,b,I,E,y,C,x,S,L,N={width:0,height:0},A=e._children,k=0,O="px",R=0,P=0,M=[[]],W=[],D=[],B=0,q=A.length,F=this._measureNode;for(k=0;q>k;k++)d=e._children[k],d._alive&&d.domNode?(d._measuredRunningWidth=P,d._markedForLayout&&((d._preLayout&&d._preLayout(t,n,o,u)||d._needsMeasuring)&&F(d,d,d._layoutCoefficients,this),h=d._layoutCoefficients,f=h.width,p=h.height,g=h.sandboxWidth,T=h.left,m=f.x1*t+f.x2*(t-P)+f.x3,U=0===p.x2?p.x1*n+p.x3:NaN,isNaN(m)||isNaN(p.x1)?(w=d._getContentSize?d._getContentSize(m,U):d._layout._doLayout(d,isNaN(m)?t:m-d._borderLeftWidth-d._borderRightWidth,isNaN(U)?n:U-d._borderTopWidth-d._borderBottomWidth,isNaN(m),isNaN(U)),isNaN(m)&&(m=w.width+d._borderLeftWidth+d._borderRightWidth),isNaN(p.x1)&&(U=w.height+d._borderTopWidth+d._borderBottomWidth),d._childrenLaidOut=!0,0===p.x2||isNaN(p.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),d._childrenLaidOut=!1)):d._childrenLaidOut=!1,d._measuredWidth=m,d._measuredHeight=U,I=d._measuredSandboxWidth=g.x1*t+g.x2+m,E=T.x1*t+T.x2+P,!o&&s(I+P)>l(t)&&(M.push([]),E-=P,P=0),d._measuredLeft=E,M[M.length-1].push(d),P+=I),P>N.width&&(N.width=P)):this.handleInvalidState(d,e);for(q=M.length,k=0;q>k;k++){for(C=M[k],x=0,S=C.length,c=0;S>c;c++)d=C[c],d._markedForLayout&&(h=d._layoutCoefficients,v=h.top,p=h.height,_=h.sandboxHeight,U=d._measuredHeight,isNaN(U)&&(d._measuredHeight=U=p.x1*n+p.x2*(n-R)+p.x3),d._childrenLaidOut||(m=d._measuredWidth,d._childrenLaidOut=!0,d._layout._doLayout(d,isNaN(m)?t:m-d._borderLeftWidth-d._borderRightWidth,isNaN(U)?n:U-d._borderTopWidth-d._borderBottomWidth,isNaN(m),isNaN(U))),0!==v.x2?(D.push(d),y=R):d._measuredTop=y=v.x1*n+v.x3*U+v.x4+R,d._measuredSandboxHeight=b=_.x1*n+_.x2+U+y-R,b>x&&(x=b));W.push(x),R+=x}for(R=0,q=M.length,k=0;q>k;k++){for(C=M[k],x=W[k],S=C.length,c=0;S>c;c++)d=C[c],d._measuredRunningHeight=R,d._measuredRowHeight=x,~D.indexOf(d)&&d._markedForLayout&&(U=d._measuredHeight,v=d._layoutCoefficients.top,d._measuredTop=v.x1*n+v.x2*x+v.x3*U+v.x4+R);R+=x}if(N.height=R,!u)switch(this._defaultVerticalAlignment){case"end":B=n-R;case"center":B/=2}for(q=A.length,k=0;q>k;k++)d=A[k],d._markedForLayout&&(r._elementLayoutCount++,d=A[k],L=d.domNode.style,L.zIndex=d.zIndex,L.left=a(d._measuredLeft)+O,L.top=a(d._measuredTop)+O,L.width=a(d._measuredWidth-d._borderLeftWidth-d._borderRightWidth)+O,L.height=a(d._measuredHeight-d._borderTopWidth-d._borderBottomWidth)+O,d._markedForLayout=!1,d.fireEvent("postlayout"));return this._computedSize=N},_getWidth:function(e,t){return!o(t)&&(t=e._defaultWidth),t===r.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===r.SIZE?r.SIZE:r.FILL:t},_getHeight:function(e,t){return!o(t)&&(t=e._defaultHeight),t===r.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._height)===r.SIZE?r.SIZE:r.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,r=e._parent._measuredHeight,n=e._measuredHeight,o=e._measuredRunningWidth,a=e._measuredRunningHeight,s=e._measuredRowHeight;return{width:t.width.x1*i+t.width.x2*(i-o)+t.width.x3,height:t.height.x1*r+t.height.x2*(r-a)+t.height.x3,left:t.left.x1*i+t.left.x2+o,top:t.top.x1*r+t.top.x2*s+t.top.x3*n+t.top.x4+a}},_measureNode:function(e,t,i,n){e._needsMeasuring=!1;var o,a,s,l,u=n.getValueType,d=n.computeValue,c=n._getWidth(e,t.width),h=u(c),f=d(c,h),p=n._getHeight(e,t.height),g=u(p),_=d(p,g),v=t.left,T=u(v),w=d(v,T),m=t.right,U=u(m),b=d(m,U),I=t.top,E=u(I),y=d(I,E),C=t.bottom,x=u(C),S=d(C,x),L=i.width,N=i.height,A=i.sandboxWidth,k=i.sandboxHeight,O=i.left,R=i.top;if(o=a=s=0,h===r.SIZE?o=a=s=NaN:h===r.FILL?(a=1,"%"===T&&(o=-w),"#"===T&&(s=-w),"%"===U&&(o=-b),"#"===U&&(s=-b)):"%"===h?o=f:"#"===h&&(s=f),L.x1=o,L.x2=a,L.x3=s,o=a=0,"%"===T&&(o=w),"#"===T&&(a=w),"%"===U&&(o+=b),"#"===U&&(a+=b),A.x1=o,A.x2=a,o=a=s=0,g===r.SIZE?o=a=s=NaN:g===r.FILL?(a=1,"%"===E&&(o=-y),"#"===E&&(s=-y)):"%"===g?o=_:"#"===g&&(s=_),N.x1=o,N.x2=a,N.x3=s,k.x1="%"===x?S:0,k.x2="#"===x?S:0,O.x1="%"===T?w:0,O.x2="#"===T?w:0,o=a=s=l=0,"%"===E)o=y;else if("#"===E)l=y;else if("%"===x)o=1-S,s=-1;else if("#"===x)o=1,s=-1,l=-S;else switch(n._defaultRowAlignment){case"center":a=.5,s=-.5;break;case"end":a=1,s=-1}R.x1=o,R.x2=a,R.x3=s,R.x4=l},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});