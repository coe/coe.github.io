define(function(){var e={},t=[];return{dynamic:!0,normalize:function(e,t){var i=e.split("!"),r=i[0];return i.shift(),(/^\./.test(r)?t(r):r)+(i.length?"!"+i.join("!"):"")},load:function(i,r,n,o){var a,s,l,u,d=i.split("!"),c=d.length;if((u=c>1&&"sandbox"===d[0])&&(d.shift(),i=d.join("!")),l=r.toUrl(/^\//.test(i)?i:"./"+i,t.length?{name:t[t.length-1]}:null),a=e[l]||r.cache(l),!a){if(s=new XMLHttpRequest,s.open("GET",l,!1),s.send(null),200!==s.status)throw new Error('Failed to load include "'+l+'": '+s.status);a=s.responseText}t.push(l);try{r.evaluate(e[l]=a,0,!u)}catch(h){throw h}finally{t.pop()}n(a)}}});