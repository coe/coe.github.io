define(["Ti/_","Ti/_/dom","Ti/_/has","Ti/_/lang","Ti/App","Ti/Platform"],function(e,t,i,r,n,o){function a(){var e=localStorage.getItem("ti:analyticsEvents");return e?JSON.parse(e):[]}function s(e){localStorage.setItem("ti:analyticsEvents",JSON.stringify(e))}function l(e){if(e&&"object"==typeof e&&e.success){var t,i=p[e.callback],r=[],n=a(),o=0,l=n.length;if(i){for(;l>o;)t=n[o++],~i.indexOf(t.id)||r.push(t);s(r)}}}var u,d=window,c=(require.is,n.analytics),h=null,f="https://api.appcelerator.com/p/v3/mobile-web-track/"+n.guid,p={},g=6e4,_={add:function(t,i,r,n){if(c){var o=a();o.push({id:e.uuid(),type:t,evt:i,ts:(new Date).toISOString().replace("Z","+0000"),data:r}),s(o),this.send(n)}},send:function(r){if(c){var s,d,v=Math.floor(1e6*Math.random()),T=Date.now(),m=[],w=[],U=sessionStorage.getItem("ti:sessionId"),b=sessionStorage.getItem("ti:analyticsSeqId"),I=a(),E=0,y=I.length,C=require.config.ti.buildType;if("string"==typeof b&&(b=JSON.parse(b)),clearTimeout(u),y&&(r||null==h||T-h>=g)){for(U||(U=e.uuid()),null==b&&(b=0);y>E;)s=I[E++],m.push(s.id),w.push(d={id:s.id,mid:o.id,rdu:null,type:s.type,aguid:n.guid,event:s.evt,seq:b++,ver:"2",deploytype:n.deployType,sid:U,ts:s.ts,data:s.data}),C&&(d.buildType=C),"ti.end"==s.type&&(b=0,U=e.uuid());if(sessionStorage.setItem("ti:sessionId",U),sessionStorage.setItem("ti:analyticsSeqId",b),p[v]=m,h=T,w=JSON.stringify(w),i("ti-analytics-use-xhr")){var x=new XMLHttpRequest;x.onreadystatechange=function(){if(4==x.readyState&&200==x.status)try{var e=JSON.parse(x.responseText);e.callback=v,l(e)}catch(t){}},x.open("POST",f,!0),x.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),x.send("content="+encodeURIComponent(w))}else{var S=document.body,N="analytics"+v,L=t.create("iframe",{id:N,name:N,style:{display:"none"}},S),A=t.create("form",{action:f+"?callback="+v+"&output=html",method:"POST",style:{display:"none"},target:N},S);t.create("input",{name:"content",type:"hidden",value:w},A),setTimeout(function(){function e(){setTimeout(function(){t.destroy(A),t.destroy(L)},1)}L.onload=e,L.onerror=e,A.submit()},25)}}u=setTimeout(function(){_.send(1)},g)}}};return require.on(d,"message",function(e){l(e.data)}),_});