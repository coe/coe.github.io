define(["Ti/_/css","Ti/_/declare","Ti/_/dom","Ti/_/event","Ti/_/has","Ti/_/lang","Ti/_/style","Ti/_/Evented","Ti/UI","Ti/UI/Animation"],function(e,t,i,r,n,o,a,s,l,u){var d=window,c=i.unitize,h=i.computeSize,f=require.on,p=a.set,g=require.is,_=o.isDef,v={post:"_doBackground"},T=function(e,t){return(null===e||!g(e,"String")&&!g(e,"Number"))&&(e=void 0),e!==t&&!this._batchUpdateInProgress&&this._triggerLayout(),e},m={set:T},w="px",U=n("touch"),b=d.navigator.msPointerEnabled;return t("Ti._.UI.Element",s,{domType:null,domNode:null,_alive:1,constructor:function(t){var n=this,o=0;n.domNode=n._setFocusNode(i.create(n.domType||"div",{className:"TiUIElement "+e.clean(n.declaredClass),"data-widget-id":n.widgetId}));n._children=[],f(n,"touchstart",n,"_doBackground"),f(n,"touchend",n,"_doBackground"),f(n.domNode,b?"MSPointerDown":U?"touchstart":"mousedown",function(e){var t=[f(d,b?"MSPointerMove":U?"touchmove":"mousemove",function(e){(U||o)&&(e._elements||(e._elements=[])).push(n)}),f(d,b?"MSPointerUp":U?"touchend":"mouseup",function(e){o=0,(e._elements||(e._elements=[])).push(n),r.off(t)}),U&&f(d,"touchcancel",function(e){(e._elements||(e._elements=[])).push(n),r.off(t)})];o=1,(e._elements||(e._elements=[])).push(n)});var a=n.__values__.constants;n._layoutCoefficients={width:{x1:0,x2:0,x3:0},minWidth:{x1:0,x2:0,x3:0},sandboxWidth:{x1:0,x2:0,x3:0},height:{x1:0,x2:0,x3:0},minHeight:{x1:0,x2:0,x3:0},sandboxHeight:{x1:0,x2:0,x3:0},left:{x1:0,x2:0,x3:0},top:{x1:0,x2:0,x3:0,x4:0}},a.size={x:0,y:0,width:0,height:0},a.rect={x:0,y:0,width:0,height:0}},fireEvent:function(e,t){t=t||{};var i,r=t.bubbles;s.fireEvent.call(this,e,t),r&&!t.cancelBubble&&this.bubbleParent&&this._parent&&(_(t.x)&&(i=this.convertPointToView({x:t.x,y:t.y},this._parent),t.x=i?i.x:t.x,t.y=i?i.y:t.y),this._parent.fireEvent(e,t))},_setParent:function(e){this._parent=e},_add:function(e,t){e._hidden=t,e._setParent(this),this._children.push(e),this.containerNode.appendChild(e.domNode),e._triggerLayout()},_insertAt:function(e,t,i){var r=this._children;t>r.length||0>t||(t===r.length?this._add(e,i):(e._parent=this,this.containerNode.insertBefore(e.domNode,r[t].domNode),r.splice(t,0,e),this._triggerLayout()))},_remove:function(e){var t=this._children,r=t.indexOf(e);-1!==r&&(t.splice(r,1),e._setParent(),i.detach(e.domNode),this._triggerLayout())},_removeAllChildren:function(e){for(var t=this._children;t.length;)this.remove(t[0]);this._triggerLayout()},destroy:function(){if(this._alive){for(var e=this._children;e.length;)e.splice(0,1)[0].destroy();this._parent&&this._parent._remove(this),this.domNode&&(i.destroy(this.domNode),this.domNode=null)}s.destroy.apply(this,arguments)},_isAttachedToActiveWin:function(){for(var e=!1,t=this;t;){if(t===l._container){e=!0;break}t=t._parent}return e},_needsMeasuring:!0,_triggerLayout:function(e){this._needsMeasuring=!0,this._isAttachedToActiveWin()&&(!this._batchUpdateInProgress||e)&&l._triggerLayout(this,e)},_hasSizeDimensions:function(){return this._hasSizeWidth()||this._hasSizeHeight()},_hasSizeHeight:function(){return isNaN(this._layoutCoefficients.height.x1)},_hasSizeWidth:function(){return isNaN(this._layoutCoefficients.width.x1)},startLayout:function(){this._batchUpdateInProgress=!0},finishLayout:function(){this._batchUpdateInProgress=!1,l._triggerLayout(this,!0)},updateLayout:function(e){this.startLayout();for(var t=0,i=e.length;i>t;t++)this[t]=e[t];this.finishLayout()},convertPointToView:function(e,t){function i(e,t,i){for(var r=t.x,n=t.y,o=i?1:-1;e;)r+=o*e.domNode.offsetLeft,n+=o*e.domNode.offsetTop,e=e._parent;return{x:r,y:n}}if(!this._isAttachedToActiveWin()||!t._isAttachedToActiveWin())return null;if(!e||!g(e.x,"Number")||!g(e.y,"Number"))throw new Error("Invalid point");if(!t.domNode)throw new Error("Invalid destination view");return i(t,i(this,e,!0),!1)},_getContentOffset:function(){return{x:0,y:0}},_computeGradient:function(){var e=this.backgroundGradient;colors=e.colors,type=e.type,cssVal=type+"-gradient(";var t=h(e.startPoint.x,this._measuredWidth),i=h(e.startPoint.y,this._measuredHeight),r=h("50%",this._measuredWidth),n=h("50%",this._measuredHeight),o=colors.length;if("linear"===type){var a,s,l=h(e.endPoint.x,this._measuredWidth),u=h(e.endPoint.y,this._measuredHeight);if(Math.abs(t-l)<.01)u>i?(a=i,s=u,cssVal+="270deg"):(a=u,s=i,cssVal+="90deg");else if(Math.abs(i-u)<.01)l>t?(a=t,s=l,cssVal+="0deg"):(a=l,s=t,cssVal+="180deg");else{var d=!1;if(t>l){d=!0;var c=t;t=l,l=c,c=i,i=u,u=c}var f=Math.atan2(u-i,l-t),_=Math.tan(f),v=Math.cos(f),T=n-r*_,m=(i-t*_-T)*v,U=m*Math.sin(f),b=m*v,t=t+U,i=i-b,l=l+U,u=u-b,I=Math.PI/2-f;if(f>0){var E=T*Math.sin(I),y=-E*Math.cos(I),C=E*Math.sin(I);a=Math.sqrt(Math.pow(t-y,2)+Math.pow(i-C,2)),s=Math.sqrt(Math.pow(l-y,2)+Math.pow(u-C,2))}else{var E=(this._measuredHeight-T)*Math.sin(I),y=-E*Math.cos(I),C=this._measuredHeight-E*Math.sin(I);a=Math.sqrt(Math.pow(t-y,2)+Math.pow(i-C,2)),s=Math.sqrt(Math.pow(l-y,2)+Math.pow(u-C,2))}f=d?f+Math.PI:f,cssVal+=Math.round(360*(2*Math.PI-f)/(2*Math.PI))+"deg"}for(var x=0;o>x;x++){var S=colors[x];g(S,"String")&&(S={color:S}),g(S.offset,"Number")||(S.offset=x/(o-1)),cssVal+=","+S.color+" "+Math.round(h(100*S.offset+"%",s-a)+a)+w}}else if("radial"===type){var L=Math.min(this._measuredWidth,this._measuredHeight),N=h(e.startRadius,L),A=h(e.endRadius,L),k=[],d=!1;if(N>A){var c=N;N=A,A=c,d=!0;for(var x=0;(o-2)/2>=x;x++){var O=o-x-1;k[x]=colors[O],k[O]=colors[x]}if(o%2===1){var M=Math.floor(o/2);k[M]=colors[M]}}else for(var x=0;o>x;x++)k[x]=colors[x];cssVal+=t+w+" "+i+w;for(var x=0;o>x;x++){var S=k[x];g(S,"String")&&(S={color:S});var R;R=g(S.offset,"Number")?d?o%2===1&&x===Math.floor(o/2)?S.offset:1-S.offset:S.offset:x/(o-1),cssVal+=","+S.color+" "+Math.round(h(100*R+"%",A-N)+N)+w}}require.config.vendorPrefixes.css.forEach(function(e){p(this.domNode,"backgroundImage",e+cssVal+")")},this)},_defaultBackgroundColor:void 0,_defaultBackgroundImage:void 0,_defaultBackgroundDisabledColor:void 0,_defaultBackgroundDisabledImage:void 0,_defaultBackgroundFocusedColor:void 0,_defaultBackgroundFocusedImage:void 0,_defaultBackgroundSelectedColor:void 0,_defaultBackgroundSelectedImage:void 0,_borderLeftWidth:0,_borderRightWidth:0,_borderTopWidth:0,_borderBottomWidth:0,_getBorderFromCSS:function(){setTimeout(o.hitch(this,function(){var e=d.getComputedStyle(this.domNode),t=Math.round(parseFloat(e["border-left-width"])),i=Math.round(parseFloat(e["border-right-width"])),r=Math.round(parseFloat(e["border-top-width"])),n=Math.round(parseFloat(e["border-bottom-width"]));isNaN(t)||isNaN(i)||isNaN(r)||isNaN(n)||(t===i&&t===r&&t===n?this.borderWidth=t:this.borderWidth=[t,i,r,n])}),1)},_doBackground:function(e){if(!this.backgroundGradient){e=e||{};var t,i=(e.type||"").match(/mouse(over|out)/),r=this.backgroundImage||this._defaultBackgroundImage||"none",n=this.backgroundColor||this._defaultBackgroundColor,o=this.backgroundRepeat,s=this.domNode.style;this._touching&&(n=this.backgroundSelectedColor||this._defaultBackgroundSelectedColor||n,r=this.backgroundSelectedImage||this._defaultBackgroundSelectedImage||r),i&&(this._over="over"===i[1]),!this._touching&&this.focusable&&this._over&&(n=this.backgroundFocusedColor||this._defaultBackgroundFocusedColor||n,r=this.backgroundFocusedImage||this._defaultBackgroundFocusedImage||r),this.enabled||(n=this.backgroundDisabledColor||this._defaultBackgroundDisabledColor||n,r=this.backgroundDisabledImage||this._defaultBackgroundDisabledImage||r),n=n||(r&&"none"!==r?"transparent":""),s.backgroundColor.toLowerCase()!==n.toLowerCase()&&(s.backgroundColor=n),"none"!=r&&(r=a.url(r)),s.backgroundImage.replace(/'|"/g,"").toLowerCase()!==r.toLowerCase()&&(s.backgroundImage="none"==r?"":r),r&&(t=o?"repeat":"no-repeat",s.backgroundRepeat!==t&&(s.backgroundRepeat=t),t=o?"auto":"100% 100%",s.backgroundSize.replace(/(100%) 100%/,"$1")!==t&&(s.backgroundSize=t))}},_setFocusNode:function(e){var t=this._focus=this._focus||{};return t.node!==e&&(t.node&&(r.off(t.evts),r.off(t.evtsMore)),t.node=e,t.evts=[f(e,"focus",this,"_doBackground"),f(e,"blur",this,"_doBackground")]),e},show:function(){this.visible=!0},hide:function(){this.visible=!1},animate:function(e,t){return this._isAttachedToActiveWin()&&u._play(this,e&&"Ti.UI.Animation"===e.declaredClass?e:new u(e)).then(t)},_setTouchEnabled:function(e){var t,i=this._children,r=0,n=i.length;for(p(this.domNode,"pointerEvents",e?"auto":"none");n>r;r++)t=i[r],t._setTouchEnabled(e&&t.touchEnabled)},_measuredLeft:0,_measuredTop:0,_measuredWidth:0,_measuredHeight:0,_measuredSandboxWidth:0,_measuredSandboxHeight:0,constants:{size:{get:function(){return{x:0,y:0,width:this._measuredWidth,height:this._measuredHeight}}},rect:{get:function(){return{x:this._measuredLeft,y:this._measuredTop,width:this._measuredWidth,height:this._measuredHeight}}},parent:function(){return this._parent}},properties:{backgroundColor:v,backgroundDisabledColor:v,backgroundDisabledImage:v,backgroundFocusedColor:v,backgroundFocusedImage:v,backgroundGradient:{set:function(e,t){if(g(e.type,"String")&&g(e.colors,"Array")&&!(e.colors.length<2)){var i=e.type,r=e.startPoint,n=e.endPoint;if("linear"===i)r&&"x"in r&&"y"in r||(e.startPoint={x:"0%",y:"50%"}),n&&"x"in n&&"y"in n||(e.endPoint={x:"100%",y:"50%"});else{if("radial"!==i)return;r&&"x"in r&&"y"in r||(e.startPoint={x:"50%",y:"50%"})}return e}},post:function(){this.backgroundGradient&&this._computeGradient()}},backgroundImage:v,backgroundRepeat:v,backgroundSelectedColor:v,backgroundSelectedImage:v,borderColor:{set:function(e){return p(this.domNode,"borderColor",e),e}},borderRadius:{set:function(e){return p(this.domNode,"borderRadius",c(e)),e},value:0},borderWidth:{set:function(e,t){if(g(e,"Array")){if(4!==e.length)return t;p(this.domNode,{borderLeftWidth:(this._borderLeftWidth=e[0])+w,borderRightWidth:(this._borderRightWidth=e[1])+w,borderTopWidth:(this._borderTopWidth=e[2])+w,borderBottomWidth:(this._borderBottomWidth=e[3])+w}),this._borderSet=!0}else{if(isNaN(e))return t;p(this.domNode,"borderWidth",e+w),this._borderLeftWidth=this._borderRightWidth=this._borderTopWidth=this._borderBottomWidth=e,this._borderSet=!0}return e},post:T,value:0},bottom:m,bubbleParent:!0,center:m,color:{set:function(e){return p(this.domNode,"color",e)}},enabled:{post:"_doBackground",set:function(e){return this._focus.node.disabled=!e,e},value:!0},focusable:{value:!1,set:function(e){return i.attr[e?"set":"remove"](this._focus.node,"tabindex",0),e}},_minHeight:m,_maxHeight:m,height:m,left:m,opacity:{set:function(e){return p(this.domNode,"opacity",e)}},visible:{set:function(e,t){return e=!!e,e!==t&&(!e&&(this._lastDisplay=a.get(this.domNode,"display")),p(this.domNode,"display",e?this._lastDisplay||"":"none"),e&&void 0!==t&&this._triggerLayout()),e}},right:m,touchEnabled:{set:function(e){return this._setTouchEnabled(e),e},value:!0},top:m,transform:{set:function(e){return p(this.domNode,"transform",e&&e.toCSS()),this._curTransform=e}},_minWidth:m,_maxWidth:m,width:m,zIndex:m}})});