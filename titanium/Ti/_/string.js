define(["Ti/_","Ti/_/has","Ti/_/lang"],function(e,t,i){function r(e,t,i){var r,n=t-10;for(d(e.arg,"String")||(e.arg=""+e.arg);e.arg.length<n;)e.arg=e.rightJustify?e.arg+i:i+e.arg;r=t-e.arg.length,e.arg=e.rightJustify?e.arg+i.substring(0,r):i.substring(0,r)+e.arg}function n(e,t){r(e,i.val(t,e.precision),f)}function o(e,t){r(e,i.val(t,e.minWidth),p)}function a(e){e.maxWidth>=0&&e.arg.length>e.maxWidth?e.arg.substring(0,e.maxWidth):e.zeroPad?n(e,e.minWidth):o(e)}function s(e){var t=parseInt(e.arg);isFinite(t)||(u(!d(e.arg,"Number"),"Format argument '"+e.arg+"' not an integer; parseInt returned "+t),t=0),0>t&&(e.isUnsigned||10!=e.base)&&(t=4294967295+t+1),0>t?(e.arg=(-t).toString(e.base),n(e),e.arg="-"+e.arg):(e.arg=t.toString(e.base),t||e.precision?n(e):e.arg="",e.sign&&(e.arg=e.sign+e.arg)),16===e.base&&(e.alternative&&(e.arg="0x"+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()),8===e.base&&e.alternative&&"0"!=e.arg.charAt(0)&&(e.arg="0"+e.arg)}function l(e){var t=parseFloat(e.arg);switch(isFinite(t)||(u(!d(e.arg,"Number"),"Format argument '"+e.arg+"' not a float; parseFloat returned "+t),t=0),e.specifier){case"e":e.arg=t.toExponential(e.precision);break;case"f":e.arg=t.toFixed(e.precision);break;case"g":Math.abs(t)<1e-4?e.arg=t.toExponential(e.precision>0?e.precision-1:e.precision):e.arg=t.toPrecision(e.precision),e.alternative||(e.arg=e.arg.replace(/(\..*[^0])0*/,"$1"),e.arg=e.arg.replace(/\.0*e/,"e").replace(/\.0$/,""));break;default:throw new Error("Unexpected double notation '"+e.doubleNotation+"'")}e.arg=e.arg.replace(/e\+(\d)$/,"e+0$1").replace(/e\-(\d)$/,"e-0$1"),h&&(e.arg=e.arg.replace(/^\./,"0.")),e.alternative&&(e.arg=e.arg.replace(/^(\d+)$/,"$1."),e.arg=e.arg.replace(/^(\d+)e/,"$1.e")),t>=0&&e.sign&&(e.arg=e.sign+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()}var u=e.assert,d=require.is,c=require.mix,h=t("opera"),f="0000000000",p="          ",g={b:{base:2,isInt:1},o:{base:8,isInt:1},x:{base:16,isInt:1},X:{extend:["x"],toUpper:1},d:{base:10,isInt:1},i:{extend:["d"]},u:{extend:["d"],isUnsigned:1},c:{setArg:function(e){if(!isNaN(e.arg)){var t=parseInt(e.arg);u(0>t||t>127,"Invalid character code passed to %c in sprintf"),e.arg=isNaN(t)?""+t:String.fromCharCode(t)}}},s:{setMaxWidth:function(e){e.maxWidth="."===e.period?e.precision:-1}},e:{isDouble:1},E:{extend:["e"],toUpper:1},f:{isDouble:1},F:{extend:["f"]},g:{isDouble:1},G:{extend:["g"],toUpper:1}};return String.format=function(e){for(var t,r,n,o,f=i.toArray(arguments),p=/\%(?:\(([\w_]+)\)|([1-9]\d*)\$)?([0 +\-\#]*)(\*|\d+)?(\.)?(\*|\d+)?[hlL]?([\%scdeEfFgGiouxX])/g,_=[],v=0,T=0,m=0,w="",U=["mapping","intmapping","flags","_minWidth","period","_precision","specifier"];r=p.exec(e);){if(o=e.slice(T,p.lastIndex-r[0].length),o.length&&_.push(o),h){for(n=r.slice(0);n.length<r.length;)n.push(null);r=n}t={},r.slice(1).concat(_.length).map(function(e,i){U[i]&&(t[U[i]]=e)}),_.push(t),t[0]&&v++,T=p.lastIndex}return o=e.slice(T),o.length&&_.push(o),f.shift(),u(!v||f.length,"Format has no mapped arguments"),_.forEach(function(t){var i,r,n,o={},h=g[t.specifier];if(d(t,"String"))w+=t;else{if(v?u(void 0===f[t.mapping],"Missing key "+t.mapping):(t.intmapping&&(m=parseInt(t.intmapping)-1),u(m<f.length,"Got "+f.length+" format arguments, insufficient for '"+e+"'")),t.arg=f[v?t.mapping:m++],!t.compiled){for(c(t,{compiled:1,sign:"",zeroPad:0,rightJustify:0,alternative:0,minWidth:0|t._minWidth,maxWidth:-1,toUpper:0,isUnsigned:0,isInt:0,isDouble:0,precision:"."===t.period?0|t._precision:1}),i=t.flags,r=i.length;r--;)switch(o[n=i.charAt(r)]=1,n){case" ":t.sign=" ";break;case"+":t.sign="+";break;case"0":t.zeroPad=!o["-"];break;case"-":t.rightJustify=1,t.zeroPad=0;break;case"#":t.alternative=1;break;default:throw new Error("Bad formatting flag '"+n+"'")}u(void 0!==h,"Unexpected specifier '"+t.specifier+"'"),h.extend&&(c(h,g[h.extend]),delete h.extend),c(t,h)}d(t.setArg,"Function")&&t.setArg(t),d(t.setMaxWidth,"Function")&&t.setMaxWidth(t),"*"===t._minWidth&&(u(v,"* width not supported in mapped formats"),u(isNaN(t.minWidth=parseInt(f[m++])),"The argument for * width at position "+m+" is not a number in "+this._format),t.minWidth<0&&(t.rightJustify=1,t.minWidth=-t.minWidth)),"*"===t._precision&&"."===t.period&&(u(v,"* precision not supported in mapped formats"),u(isNaN(t.precision=parseInt(f[m++])),"The argument for * precision at position "+m+" is not a number in "+this._format),t.precision<0&&(t.precision=1,t.period="")),t.isInt?("."===t.period&&(t.zeroPad=0),s(t)):t.isDouble&&("."!==t.period&&(t.precision=6),l(t)),a(t),w+=""+t.arg}}),w},{capitalize:function(e){return e=e||"",e.substring(0,1).toUpperCase()+e.substring(1)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}});