define(["Ti/_","Ti/_/declare","Ti/_/has","Ti/_/lang","Ti/_/Evented","Ti/Filesystem","Ti/Network","Ti/Blob","Ti/_/event","Ti/App"],function(e,t,i,r,o,n,a,s,l,u){var d=require.is,c=require.on;return t("Ti.Network.HTTPClient",o,{constructor:function(){var e=this._xhr=new XMLHttpRequest;this._handles=[c(e,"error",this,"_onError"),e.upload&&c(e.upload,"error",this,"_onError"),c(e,"progress",this,function(e){e.progress=e.lengthComputable?e.loaded/e.total:!1,d(this.ondatastream,"Function")&&this.ondatastream.call(this,e)}),e.upload&&c(e.upload,"progress",this,function(e){e.progress=e.lengthComputable?e.loaded/e.total:!1,d(this.onsendstream,"Function")&&this.onsendstream.call(this,e)})],e.onreadystatechange=r.hitch(this,function(){var t,r=this.__values__.constants,o=this.onload;switch(e.readyState){case 0:r.readyState=this.UNSENT;break;case 1:r.readyState=this.OPENED;break;case 2:r.readyState=this.LOADING;break;case 3:r.readyState=this.HEADERS_RECEIVED;break;case 4:clearTimeout(this._timeoutTimer),this._completed=1,r.readyState=this.DONE,this._aborted||((t=this.file)&&(t=n.getFile(t),t.writable&&t.write(e.responseText)),r.responseText=e.responseText,r.responseData=new s({data:e.responseText,length:e.responseText.length,mimeType:e.getResponseHeader("Content-Type")||"text/plain"}),r.responseXML=e.responseXML,i("ti-instrumentation")&&instrumentation.stopTest(this._requestInstrumentationTest,this.location),e.status>=400&&(o=this._onError),d(o,"Function")&&o.call(this))}this._fireStateChange()})},destroy:function(){this._xhr&&(this._xhr.abort(),this._xhr=null),l.off(this._handles),o.destroy.apply(this,arguments)},_onError:function(e){d(e,"Object")||(e={message:e}),e.source=this,e.type="error",e.error||(e.error=e.message||this._xhr.status),parseInt(e.error)||(e.error="Can't reach host"),d(this.onerror,"Function")&&this.onerror.call(this,e)},abort:function(){clearTimeout(this._timeoutTimer),this._aborted=1,this.connected&&this._xhr.abort(),this.__values__.constants.readyState=this.UNSENT,this._fireStateChange()},_fireStateChange:function(){d(this.onreadystatechange,"Function")&&this.onreadystatechange.call(this)},getResponseHeader:function(e){return this._xhr.readyState>1?this._xhr.getResponseHeader(e):null},open:function(t,i,r){var o=Ti.Network.httpURLFormatter,n=this.__values__.constants,a=this.withCredentials,s=e.getAbsolutePath(o?o(i):i),l=s.match(/^((?:.+\:)?\/\/)?(?:.+@)?(.*)$/);l&&this.username&&this.password&&(s=(l[1]||"")+(this.domain?this.domain+"\\":"")+this.username+":"+this.password+"@"+l[2]),this.abort(),this._xhr.open(n.connectionType=t,n.location=s,a||void 0===r?!0:!!r),a&&(this._xhr.withCredentials=a)},send:function(e){try{var t=0|this.timeout;this._aborted=this._completed=0,i("ti-instrumentation")&&(this._requestInstrumentationTest=instrumentation.startTest("HTTP Request")),e=d(e,"Object")?r.urlEncode(e):e,this._contentTypeSet||e&&this._xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this._xhr.setRequestHeader("X-Titanium-Id",u.guid),this._xhr.send(e),clearTimeout(this._timeoutTimer),t&&(this._timeoutTimer=setTimeout(r.hitch(this,function(){this.connected&&(this.abort(),!this._completed&&this._onError("Request timed out"))}),t))}catch(o){}},setRequestHeader:function(e,t){"Content-Type"===e&&(this._contentTypeSet=1),this._xhr.setRequestHeader(e,t)},properties:{ondatastream:void 0,onerror:void 0,onload:void 0,onreadystatechange:void 0,onsendstream:void 0,timeout:void 0,username:null,password:null,domain:null,withCredentials:!1},constants:{DONE:4,HEADERS_RECEIVED:2,LOADING:3,OPENED:1,UNSENT:1,connected:function(){return this.readyState>=this.OPENED},connectionType:void 0,location:void 0,readyState:this.UNSENT,responseData:void 0,responseText:void 0,responseXML:void 0,status:function(){return this._xhr.status},statusText:function(){return this._xhr.statusText}}})});