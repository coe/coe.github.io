var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Search User"]=function(e){function t(){return r.value.length?(r.blur(),o.hide(),void Cloud.Users.search({q:r.value},function(e){if(o.show(),e.success)if(0==e.users.length)n.setData([{title:"No Results!"}]);else{for(var t=[],i=0,r=e.users.length;r>i;i++)t.push(Ti.UI.createTableViewRow({title:e.users[i].first_name+" "+e.users[i].last_name,id:e.users[i].id}));n.setData(t)}else Utils.error(e)})):void r.focus()}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createTextField({hintText:"Full Text Search",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});i.add(r);var o=Ti.UI.createButton({title:"Search",top:60+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u});i.add(o);var n=Ti.UI.createTableView({backgroundColor:"#fff",top:110+Utils.u,bottom:0});return n.addEventListener("click",function(e){e.row.id&&WindowManager.handleOpenWindow({target:"Show User",id:e.row.id})}),i.add(n),o.addEventListener("click",t),r.addEventListener("return",t),i.addEventListener("open",function(){r.focus()}),i};