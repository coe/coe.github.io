var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Update Event"]=function(e){function t(){c.hide();var t,i={event_id:e.id,name:n.value};if(t=Date.parse(o.value+" "+a.value),isNaN(t))return alert("Please enter a valid date/time"),void o.focus();if(i.start_time=new Date(t),t=parseInt(s.value,10),isNaN(t)||(i.duration=t),l.value.length>0){i.recurring=l.value.toLowerCase();var r={daily:1,weekly:1,monthly:1,yearly:1};if(!r[i.recurring])return alert("Enter 'daily', 'weekly', 'monthly', or 'yearly'"),void l.focus()}t=parseInt(u.value,10),isNaN(t)||(i.recurring_count=t),Cloud.Events.update(i,function(e){e.success?alert("Updated!"):Utils.error(e),c.show()})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});i.add(r);var n=Ti.UI.createTextField({hintText:"Name",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});r.add(n);var o=Ti.UI.createTextField({hintText:"Date",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});r.add(o);var a=Ti.UI.createTextField({hintText:"Time",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});r.add(a);var s=Ti.UI.createTextField({hintText:"Duration (seconds)",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,keyboardType:Ti.UI.KEYBOARD_NUMBER_PAD});r.add(s);var l=Ti.UI.createTextField({hintText:"Recurring",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE});r.add(l);var u=Ti.UI.createTextField({hintText:"Recurring Count (0-1000)",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,keyboardType:Ti.UI.KEYBOARD_NUMBER_PAD});r.add(u);var c=Ti.UI.createButton({title:"Update",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});r.add(c),c.addEventListener("click",t);for(var d=[n,o,a,s,l,u],p=0;p<d.length;p++)d[p].addEventListener("return",t);var h=Ti.UI.createLabel({text:"Loading, please wait...",textAlign:"center",top:0,right:0,bottom:0,left:0,backgroundColor:"#fff",zIndex:2});return i.add(h),i.addEventListener("open",function(){Cloud.Events.show({event_id:e.id},function(e){if(h.hide(),e.success){var t=e.events[0],i=Utils.convertISOToDate(t.start_time);n.value=t.name,o.value=i.toLocaleDateString(),a.value=i.toLocaleTimeString(),t.duration&&(s.value=t.duration.toString()),l.value=t.recurring||"",t.recurring_count&&(u.value=t.recurring_count.toString()),n.focus()}else Utils.error(e)})}),i};