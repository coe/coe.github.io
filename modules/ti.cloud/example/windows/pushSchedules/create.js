var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Create Push Schedule"]=function(e){function t(){for(var e=0;e<u.length;e++){if(!u[e].value.length)return void u[e].focus();u[e].blur()}l.hide();var t={name:o.value,start_time:n.value},i=s.value;if(i.indexOf("{")>=0)try{t.push_notification=JSON.parse(i)}catch(r){return void alert("Failed to parse: "+r.message)}else t.push_notification=i;var d=a.value;if(d.indexOf("{")>=0)try{t.recurrence=JSON.parse(d)}catch(r){return void alert("Failed to parse: "+r.message)}else t.recurrence=d;Cloud.PushSchedules.create({schedule:JSON.stringify(t)},function(e){e.success?alert("Created!"):Utils.error(e),l.show()})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});i.add(r);var o=Ti.UI.createTextField({hintText:"name",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});r.add(o);var n=Ti.UI.createTextField({hintText:"YYYY-MM-DDTHH:MM",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});r.add(n);var a=Ti.UI.createTextField({hintText:'{"interval":"daily","end_time":"YYYY-MM-DDTHH:MM"}',top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});r.add(a);var s=Ti.UI.createTextField({hintText:'{"payload":"hello world","channel":"channel"}',top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});r.add(s);var l=Ti.UI.createButton({title:"Create",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});r.add(l);var u=[o,n,a,s];l.addEventListener("click",t);for(var d=0;d<u.length;d++)u[d].addEventListener("return",t);return i};