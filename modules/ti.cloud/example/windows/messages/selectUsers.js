var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Select Users for Message"]=function(e){function t(){Cloud.Users.query(function(e){if(e.success)if(0==e.users.length)n.setData([{title:"No Users!"}]);else{for(var t=[],i=0,o=e.users.length;o>i;i++){var a=e.users[i],s=Ti.UI.createTableViewRow({title:a.first_name+" "+a.last_name,id:a.id});s.hasCheck=-1!=r.ids.indexOf(a.id),t.push(s)}n.setData(t)}else n.setData([{title:e.error&&e.message||e}]),Utils.error(e)})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=e.toSet,n=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0,data:[{title:"Loading, please wait..."}]});return n.addEventListener("click",function(e){if(e.row.id)if(e.row.hasCheck=!e.row.hasCheck,e.row.hasCheck)r.ids.push(e.row.id),r.names.push(e.row.title);else{var t=r.ids.indexOf(e.row.id);r.ids.splice(t,1),r.names.splice(t,1)}}),i.add(n),i.addEventListener("open",function(){t()}),i};