var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Create Message"]=function(e){var t=WindowManager.createWindow({backgroundColor:"white"}),i=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});t.add(i);var r=Ti.UI.createView({top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:Ti.UI.SIZE||"auto",layout:"horizontal"}),n={ids:[],names:[]},o=Ti.UI.createButton({title:"To:",height:40+Utils.u,width:Ti.UI.SIZE||"auto"});o.addEventListener("click",function(e){WindowManager.handleOpenWindow({target:"Select Users for Message",toSet:n})}),r.add(o);var a=Ti.UI.createTextField({left:10+Utils.u,right:0,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,editable:!1,ellipsize:!0});r.add(a),i.add(r);var s=Ti.UI.createTextField({hintText:"Subject",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocorrect:!1});i.add(s);var l=Ti.UI.createTextArea({hintText:"Body",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:120+Utils.u,borderWidth:2,borderColor:"#bbb",borderRadius:5,font:{fontSize:20}});i.add(l);var u=Ti.UI.createButton({title:"Create",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});return u.addEventListener("click",function(e){u.hide(),Cloud.Messages.create({to_ids:n.ids.join(","),body:l.value,subject:s.value},function(e){e.success?(alert("Created!"),l.value=s.value=a.value="",n.ids=[],n.names=[]):Utils.error(e),u.show()})}),i.add(u),t.addEventListener("open",function(){s.focus()}),t.addEventListener("focus",function(){a.value=n.names.join(",")}),t};