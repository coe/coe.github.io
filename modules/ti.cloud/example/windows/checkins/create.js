var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Create Checkin"]=function(e){function t(e,t){Cloud.Places.search({latitude:e,longitude:t},function(e){if(e.success)if(0==e.places.length)n.setData([{title:"No Results!"}]);else{for(var t=[],i=0,r=e.places.length;r>i;i++)t.push(Ti.UI.createTableViewRow({title:e.places[i].name,id:e.places[i].id}));n.setData(t)}else Utils.error(e)})}function i(){n.setData([{title:"Geolocating..."}]),Ti.Geolocation?(Ti.Geolocation.purpose="To find nearby places.",Ti.Geolocation.accuracy=Ti.Geolocation.ACCURACY_BEST,Ti.Geolocation.distanceFilter=0,Ti.Geolocation.getCurrentPosition(function(e){!e.success||e.error?(t(null,null),n.setData([{title:"GPS lost, looking nearby..."}])):(n.setData([{title:"Located, looking nearby..."}]),t(e.coords.latitude,e.coords.longitude))})):Cloud.Clients.geolocate(function(e){e.success?(n.setData([{title:"Located, looking nearby..."}]),t(e.location.latitude,e.location.longitude)):(t(null,null),n.setData([{title:"GPS lost, looking nearby..."}]))})}var r=WindowManager.createWindow({backgroundColor:"white"}),n=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0});return n.addEventListener("click",function(e){if(e.row.id){var t=e.row.title;e.row.title="Checking in, please wait...",Cloud.Checkins.create({place_id:e.row.id},function(i){e.row.title=t,i.success?alert("Checked in to "+t+"!"):Utils.error(i)})}}),r.add(n),r.addEventListener("open",i),r};