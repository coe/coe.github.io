var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports.Notify=function(e){function t(){l.title=s?"Push Goes to Friends":"Push Goes to User"}function i(){for(var e=0;e<d.length;e++){if(!d[e].value.length)return void d[e].focus();d[e].blur()}u.hide();var t={channel:n.value},i=a.value;if(i.indexOf("{")>=0)try{t.payload=JSON.parse(i)}catch(r){return void alert("Failed to parse: "+r.message)}else t.payload=i;s&&(t.friends=!0),Cloud.PushNotifications.notify(t,function(e){e.success?alert("Notified!"):Utils.error(e),u.show()})}var r=WindowManager.createWindow({backgroundColor:"white"}),o=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});r.add(o);var n=Ti.UI.createTextField({hintText:"Channel",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});o.add(n);var a=Ti.UI.createTextField({hintText:"Payload (String or JSON)",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,autocorrect:!1});o.add(a);var s=!1,l=Ti.UI.createButton({top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});l.addEventListener("click",function(){s=!s,t()}),o.add(l),t();var u=Ti.UI.createButton({title:"Notify",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});o.add(u);var d=[n,a];u.addEventListener("click",i);for(var c=0;c<d.length;c++)d[c].addEventListener("return",i);return r.addEventListener("open",function(){n.focus()}),r};