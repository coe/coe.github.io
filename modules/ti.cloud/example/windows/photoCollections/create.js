var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Create Photo Collection"]=function(e){function t(){for(var e=0;e<l.length;e++){if(!l[e].value.length)return void l[e].focus();l[e].blur()}s.hide(),Cloud.PhotoCollections.create({name:n.value,parent_collection_id:o},function(e){e.success?(alert("Created!"),n.value="",o=null):Utils.error(e),s.show()})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});i.add(r);var n=Ti.UI.createTextField({hintText:"Name",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});r.add(n);var o,a=Ti.UI.createButton({title:"Choose Parent Collection",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});a.addEventListener("click",function(){function t(t){Cloud.PhotoCollections.search({user_id:t},function(t){if(t.success)if(0==t.collections.length)i.remove(r),alert("No photo collections exist! Create one first.");else{var n=[];n.push(Ti.UI.createTableViewRow({title:"No Collection",id:"",hasCheck:!o}));for(var a=0,s=t.collections.length;s>a;a++)t.collections[a].id!=e.id&&n.push(Ti.UI.createTableViewRow({title:t.collections[a].name,id:t.collections[a].id,hasCheck:o==t.collections[a].id}));r.setData(n)}else i.remove(r),Utils.error(t)})}var r=Ti.UI.createTableView({backgroundColor:"#fff",data:[{title:"Loading, please wait..."}]});r.addEventListener("click",function(e){o=e.row.id,i.remove(r)}),i.add(r),Cloud.Users.showMe(function(e){e.success?t(e.users[0].id):(r.setData([{title:e.error&&e.message||e}]),Utils.error(e))})}),r.add(a);var s=Ti.UI.createButton({title:"Create",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});r.add(s),s.addEventListener("click",t);for(var l=[n],u=0;u<l.length;u++)l[u].addEventListener("return",t);return i.addEventListener("open",function(){n.focus()}),i};