var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Add Friends"]=function(e){function t(e){Cloud.Users.showMe(function(t){t.success?e(t.users[0].id):(o.setData([{title:t.error&&t.message||t}]),Utils.error(t))})}function i(e){Cloud.Users.query(function(t){if(t.success){var i=[];i.push({title:"Send Friend Request!"});for(var r=0,n=t.users.length;n>r;r++)if(t.users[r].id!=e){var a=t.users[r],s=Ti.UI.createTableViewRow({title:a.first_name+" "+a.last_name,id:a.id});i.push(s)}i.length<=1?o.setData([{title:"No Other Users"}]):o.setData(i)}else o.setData([{title:t.error&&t.message||t}]),Utils.error(t)})}var r=WindowManager.createWindow({backgroundColor:"white"}),n=[],o=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0,data:[{title:"Loading, please wait..."}]});return o.addEventListener("click",function(e){e.row.id?(e.row.hasCheck=!e.row.hasCheck,e.row.hasCheck?n.push(e.row.id):n.splice(n.indexOf(e.row.id),1)):0==n.length?alert("No users selected"):Cloud.Friends.add({user_ids:n.join(",")},function(e){e.success?alert("Friend(s) added"):Utils.error(e)})}),r.add(o),r.addEventListener("open",function(){t(i)}),r};