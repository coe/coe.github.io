var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Remove Friends"]=function(e){function t(e){Cloud.Users.showMe(function(t){t.success?e(t.users[0].id):(o.setData([{title:t.error&&t.message||t}]),Utils.error(t))})}function i(e){Cloud.Friends.search({user_id:e},function(e){if(e.success)if(0==e.users.length)o.setData([{title:"No friends"}]);else{var t=[];t.push({title:"Remove Friend(s)!"});for(var i=0,r=e.users.length;r>i;i++){var n=e.users[i],a=Ti.UI.createTableViewRow({title:n.first_name+" "+n.last_name,id:n.id});t.push(a)}o.setData(t)}else o.setData([{title:e.error&&e.message||e}]),Utils.error(e)})}var r=WindowManager.createWindow({backgroundColor:"white"}),n=[],o=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0,data:[{title:"Loading, please wait..."}]});return o.addEventListener("click",function(e){e.row.id?(e.row.hasCheck=!e.row.hasCheck,e.row.hasCheck?n.push(e.row.id):n.splice(n.indexOf(e.row.id),1)):0==n.length?alert("No friends selected"):Cloud.Friends.remove({user_ids:n.join(",")},function(e){e.success?alert("Friend(s) removed"):Utils.error(e)})}),r.add(o),r.addEventListener("open",function(){t(i)}),r};