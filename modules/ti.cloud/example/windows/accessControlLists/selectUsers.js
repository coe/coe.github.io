var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Select Users for ACL"]=function(e){function t(){Cloud.Users.query(function(e){if(e.success)if(0==e.users.length)n.setData([{title:"No Users!"}]);else{var t=[];"undefined"!=typeof r.publicAccess&&t.push({title:"<Public Access>",id:"publicAccess",hasCheck:r.publicAccess||!1});for(var i=0,o=e.users.length;o>i;i++){var s=e.users[i],a=Ti.UI.createTableViewRow({title:s.first_name+" "+s.last_name,id:s.id});a.hasCheck=-1!=r.ids.indexOf(s.id),t.push(a)}n.setData(t)}else n.setData([{title:e.error&&e.message||e}]),Utils.error(e)})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=e.access,n=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0,data:[{title:"Loading, please wait..."}]});return n.addEventListener("click",function(e){e.row.id&&(e.row.hasCheck=!e.row.hasCheck,"publicAccess"===e.row.id?r.publicAccess=e.row.hasCheck:e.row.hasCheck?r.ids.push(e.row.id):r.ids.splice(r.ids.indexOf(e.row.id),1))}),i.add(n),i.addEventListener("open",function(){t()}),i};