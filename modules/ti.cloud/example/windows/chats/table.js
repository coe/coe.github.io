var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");WindowManager.include("/windows/chats/selectUsersForGroup","/windows/chats/showChatGroup","/windows/chats/query"),exports.Chats=function(e){function t(){r.setData([{title:"Loading, please wait..."}]),Cloud.Chats.getChatGroups(function(e){if(e.success){var t=[];t.push({title:"Query Chat Groups"}),t.push({title:"Create new group!"});for(var i=0,n=e.chat_groups.length;n>i;i++){for(var o=e.chat_groups[i],s="",a=0;a<o.participate_users.length;a++)s+=", "+o.participate_users[a].first_name+" "+o.participate_users[a].last_name;t.push(Ti.UI.createTableViewRow({title:s.substr(2),id:o.id}))}r.setData(t)}else Utils.error(e)})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0});return r.addEventListener("click",function(e){e.row.id?WindowManager.handleOpenWindow({target:"Show Chat Group",id:e.row.id}):"Query Chat Groups"===e.row.title?WindowManager.handleOpenWindow({target:"Query Chat Groups"}):WindowManager.handleOpenWindow({target:"Select Users for Group"})}),i.add(r),i.addEventListener("open",t),i.addEventListener("focus",t),i};