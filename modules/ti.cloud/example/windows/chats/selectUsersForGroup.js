var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Select Users for Group"]=function(e){function t(e){Cloud.Users.showMe(function(t){t.success?e(t.users[0].id):(o.setData([{title:t.error&&t.message||t}]),Utils.error(t))})}function i(e){Cloud.Users.query(function(t){if(t.success)if(0==t.users.length)o.setData([{title:"No Other Users! Cannot chat!"}]);else{var i=[];i.push({title:"Start Chatting!"});for(var r=0,s=t.users.length;s>r;r++){var a=t.users[r],l=Ti.UI.createTableViewRow({title:a.first_name+" "+a.last_name,id:a.id}),u=a.id==e;u&&(l.isMyID=l.hasCheck=n[a.id]=!0),i.push(l)}o.setData(i)}else o.setData([{title:t.error&&t.message||t}]),Utils.error(t)})}var r=WindowManager.createWindow({backgroundColor:"white"}),n={},o=Ti.UI.createTableView({backgroundColor:"#fff",top:0,bottom:0,data:[{title:"Loading, please wait..."}]});return o.addEventListener("click",function(e){if(e.row.id){if(e.row.isMyID)return;e.row.hasCheck=!e.row.hasCheck,n[e.row.id]=e.row.hasCheck,e.row.hasCheck||delete n[e.row.id]}else{var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);t.length?WindowManager.handleOpenWindow({target:"Show Chat Group",ids:t}):alert("Please check at least one user!")}}),r.add(o),r.addEventListener("open",function(){t(i)}),r};