var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Update Status"]=function(e){function t(){for(var e=0;e<g.length;e++){if(!g[e].value.length)return void g[e].focus();g[e].blur()}c.hide(),l&&Ti.UI.createProgressBar&&(Cloud.onsendstream=function(e){f.value=.5*e.progress},Cloud.ondatastream=function(e){f.value=.5*e.progress+.5}),Cloud.Statuses.update({status_id:o,message:s.value,photo:l},function(e){l&&Ti.UI.createProgressBar&&(Cloud.onsendstream=Cloud.ondatastream=null),e.success?(s.value="",l=null,alert("Updated!")):Utils.error(e),c.show()})}function i(e){WindowManager.handleOpenWindow({target:"Show Status",id:o})}function r(e){WindowManager.handleOpenWindow({target:"Remove Status",id:o})}var o=e.id,n=WindowManager.createWindow({backgroundColor:"white"}),a=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});n.add(a);var s=Ti.UI.createTextField({hintText:"Message",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});a.add(s);var l;if(Ti.Media.openPhotoGallery){var u=Ti.UI.createButton({title:"Select Photo from Gallery",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});u.addEventListener("click",function(e){Ti.Media.openPhotoGallery({success:function(e){l=e.media}})}),a.add(u)}if(Ti.Media.showCamera){var d=Ti.UI.createButton({title:"Take Photo with Camera",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});d.addEventListener("click",function(e){Ti.Media.showCamera({success:function(e){l=e.media}})}),a.add(d)}var c=Ti.UI.createButton({title:"Update",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});a.add(c);var h=Ti.UI.createButton({title:"Show",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});a.add(h);var p=Ti.UI.createButton({title:"Delete",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});if(a.add(p),Ti.UI.createProgressBar){var f=Ti.UI.createProgressBar({top:10+Utils.u,right:10+Utils.u,left:10+Utils.u,max:1,min:0,value:0,height:25+Utils.u});a.add(f),f.show()}var g=[s];c.addEventListener("click",t),h.addEventListener("click",i),p.addEventListener("click",r);for(var U=0;U<g.length;U++)g[U].addEventListener("return",t);return n.addEventListener("open",function(){s.focus()}),n};