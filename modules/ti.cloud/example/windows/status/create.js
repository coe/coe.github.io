var WindowManager=require("helper/WindowManager"),Utils=require("helper/Utils"),Cloud=require("ti.cloud");exports["Create Status"]=function(e){function t(){for(var e=0;e<d.length;e++){if(!d[e].value.length)return void d[e].focus();d[e].blur()}l.hide(),n&&Ti.UI.createProgressBar&&(Cloud.onsendstream=function(e){u.value=.5*e.progress},Cloud.ondatastream=function(e){u.value=.5*e.progress+.5}),Cloud.Statuses.create({message:o.value,photo:n},function(e){n&&Ti.UI.createProgressBar&&(Cloud.onsendstream=Cloud.ondatastream=null),e.success?(o.value="",n=null,alert("Updated!")):Utils.error(e),l.show()})}var i=WindowManager.createWindow({backgroundColor:"white"}),r=Ti.UI.createScrollView({top:0,contentHeight:"auto",layout:"vertical"});i.add(r);var o=Ti.UI.createTextField({hintText:"Message",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,height:40+Utils.u,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});r.add(o);var n;if(Ti.Media.openPhotoGallery){var a=Ti.UI.createButton({title:"Select Photo from Gallery",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});a.addEventListener("click",function(e){Ti.Media.openPhotoGallery({success:function(e){n=e.media}})}),r.add(a)}if(Ti.Media.showCamera){var s=Ti.UI.createButton({title:"Take Photo with Camera",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});s.addEventListener("click",function(e){Ti.Media.showCamera({success:function(e){n=e.media}})}),r.add(s)}var l=Ti.UI.createButton({title:"Create",top:10+Utils.u,left:10+Utils.u,right:10+Utils.u,bottom:10+Utils.u,height:40+Utils.u});if(r.add(l),Ti.UI.createProgressBar){var u=Ti.UI.createProgressBar({top:10+Utils.u,right:10+Utils.u,left:10+Utils.u,max:1,min:0,value:0,height:25+Utils.u});r.add(u),u.show()}var d=[o];l.addEventListener("click",t);for(var c=0;c<d.length;c++)d[c].addEventListener("return",t);return i.addEventListener("open",function(){o.focus()}),i};