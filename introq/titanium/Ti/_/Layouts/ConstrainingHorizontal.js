define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,a,t,i){var n=i.isDef,s=Math.round;return a("Ti._.Layouts.ConstrainingHorizontal",e,{_doLayout:function(e,a,i,n,o){var r,_,l,d,c,u,p,m,g,k,b,h,y,f,v,w,z,S={width:0,height:0},j=e._children,P=0,A="px",T=[],I=0,x=0,M=j.length,N=this._measureNode;for(P=0;M>P;P++)r=e._children[P],r._alive&&r.domNode?r._markedForLayout&&((r._preLayout&&r._preLayout(a,i,n,o)||r._needsMeasuring)&&N(r,r,r._layoutCoefficients,this),_=r._layoutCoefficients,l=_.width,0===l.x2||isNaN(l.x2)?(d=_.height,c=_.sandboxWidth,u=_.sandboxHeight,b=d.x1*i+d.x2,k=l.x1*a+l.x2*(a-I)+l.x3,g=r._getContentSize?r._getContentSize(k,b):r._layout._doLayout(r,isNaN(k)?a:k-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?i:b-r._borderTopWidth-r._borderBottomWidth,isNaN(k),isNaN(b)),isNaN(k)&&(k=g.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=g.height+r._borderTopWidth+r._borderBottomWidth),y=r._measuredSandboxWidth=c.x1*a+c.x2+k,I+=y,r._measuredWidth=k,r._measuredHeight=b):x++):this.handleInvalidState(r,e);for(w=a-I,I=Math.floor(w/x),P=0;M>P;P++)r=e._children[P],r._markedForLayout&&(_=r._layoutCoefficients,l=_.width,0===l.x2||isNaN(l.x2)||(d=_.height,c=_.sandboxWidth,u=_.sandboxHeight,b=d.x1*i+d.x2,k=l.x1*a+l.x2*(M-1>P?I:w-I*(x-1))+l.x3,g=r._getContentSize?r._getContentSize(k,b):r._layout._doLayout(r,isNaN(k)?a:k-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?i:b-r._borderTopWidth-r._borderBottomWidth,isNaN(k),isNaN(b)),isNaN(k)&&(k=g.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=g.height+r._borderTopWidth+r._borderBottomWidth),r._measuredWidth=k,r._measuredHeight=b,y=r._measuredSandboxWidth=c.x1*a+c.x2+k));for(I=0,P=0;M>P;P++)r=e._children[P],r._measuredRunningWidth=I,r._markedForLayout?(_=r._layoutCoefficients,u=_.sandboxHeight,p=_.top,m=_.left,o&&0!==p.x1?T.push(r):(b=r._measuredHeight,v=r._measuredTop=p.x1*i+p.x2*b+p.x3,h=r._measuredSandboxHeight=u.x1*i+u.x2+b+(isNaN(v)?0:v),r._measuredSandboxHeight>S.height&&(S.height=r._measuredSandboxHeight)),f=r._measuredLeft=m.x1*a+m.x2+I):r._measuredSandboxHeight>S.height&&(S.height=r._measuredSandboxHeight),I+=r._measuredSandboxWidth;for(S.width=I,M=T.length,P=0;M>P;P++)r=T[P],u=r._layoutCoefficients.sandboxHeight,h=r._measuredSandboxHeight=u.x1*i+u.x2+r._measuredHeight,h>S.height&&(S.height=h);for(P=0;M>P;P++)r=T[P],p=r._layoutCoefficients.top,u=r._layoutCoefficients.sandboxHeight,b=r._measuredHeight,h=r._measuredSandboxHeight,h>S.height&&(S.height=h),v=r._measuredTop=p.x1*S.height+p.x2*b+p.x3,r._measuredSandboxHeight+=isNaN(v)?0:v;for(M=j.length,P=0;M>P;P++)r=j[P],r._markedForLayout&&(t._elementLayoutCount++,r=j[P],z=r.domNode.style,z.zIndex=r.zIndex,z.left=s(r._measuredLeft)+A,z.top=s(r._measuredTop)+A,z.width=s(r._measuredWidth-r._borderLeftWidth-r._borderRightWidth)+A,z.height=s(r._measuredHeight-r._borderTopWidth-r._borderBottomWidth)+A,r._markedForLayout=!1,r.fireEvent("postlayout"));return this._computedSize=S},_getWidth:function(e,a){return!n(a)&&(a=e._defaultWidth),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_getHeight:function(e,a){return!n(a)&&2>n(e.top)+n(e.center&&e.center.y)+n(e.bottom)&&(a=e._defaultHeight),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_isDependentOnParent:function(e){var a=e._layoutCoefficients;return!isNaN(a.width.x1)&&0!==a.width.x1||!isNaN(a.width.x2)&&0!==a.width.x2||!isNaN(a.height.x1)&&0!==a.height.x1||0!==a.sandboxWidth.x1||0!==a.sandboxHeight.x1||0!==a.left.x1||0!==a.top.x1},_doAnimationLayout:function(e,a){var t=e._parent._measuredWidth,i=e._parent._measuredHeight,n=e._measuredRunningWidth,s=a.height.x1*i+a.height.x2;return{width:a.width.x1*t+a.width.x2*(t-n)+a.width.x3,height:s,left:a.left.x1*t+a.left.x2+n,top:a.top.x1*i+a.top.x2*s+a.top.x3}},_measureNode:function(e,a,i,n){e._needsMeasuring=!1;var s,o,r,_=n.getValueType,l=n.computeValue,d=n._getWidth(e,a.width),c=_(d),u=l(d,c),p=n._getHeight(e,a.height),m=_(p),g=l(p,m),k=a.left,b=_(k),h=l(k,b),y=a.right,f=_(y),v=l(y,f),w=a.top,z=_(w),S=l(w,z),j=a.center&&a.center.y,P=_(j),A=l(j,P),T=a.bottom,I=_(T),x=l(T,I),M=i.width,N=i.height,D=i.sandboxWidth,C=i.sandboxHeight,B=i.left,W=i.top;if(s=o=0,m===t.SIZE?s=o=0/0:m===t.FILL?(s=1,"%"===z?s-=S:"#"===z?o=-S:"%"===I?s-=x:"#"===I&&(o=-x)):"%"===m?s=g:"#"===m?o=g:"%"===z?"%"===P?s=2*(A-S):"#"===P?(s=-2*S,o=2*A):"%"===I?s=1-S-x:"#"===I&&(s=1-S,o=-x):"#"===z?"%"===P?(s=2*A,o=-2*S):"#"===P?o=2*(A-S):"%"===I?(s=1-x,o=-S):"#"===I&&(s=1,o=-x-S):"%"===P?"%"===I?s=2*(x-A):"#"===I&&(s=-2*A,o=2*x):"#"===P&&("%"===I?(s=2*x,o=-2*A):"#"===I&&(o=2*(x-A))),N.x1=s,N.x2=o,C.x1="%"===I?x:0,C.x2="#"===I?x:0,s=o=r=0,c===t.SIZE?s=o=r=0/0:c===t.FILL?(o=1,"%"===b&&(s=-h),"#"===b&&(r=-h),"%"===f&&(s=-v),"#"===f&&(r=-v)):"%"===c?s=u:"#"===c&&(r=u),M.x1=s,M.x2=o,M.x3=r,s=o=0,"%"===b&&(s=h),"#"===b&&(o=h),"%"===f&&(s+=v),"#"===f&&(o+=v),D.x1=s,D.x2=o,s=o=r=0,"%"===z)s=S;else if("#"===z)r=S;else if("%"===P)s=A,o=-.5;else if("#"===P)o=-.5,r=A;else if("%"===I)s=1-x,o=-1;else if("#"===I)s=1,o=-1,r=-x;else switch(n._defaultVerticalAlignment){case"center":s=.5,o=-.5;break;case"end":s=1,o=-1}W.x1=s,W.x2=o,W.x3=r,B.x1="%"===b?h:0,B.x2="#"===b?h:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});