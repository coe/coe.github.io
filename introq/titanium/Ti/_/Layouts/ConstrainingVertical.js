define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,a,t,i){var n=i.isDef,s=Math.round;return a("Ti._.Layouts.ConstrainingVertical",e,{_doLayout:function(e,a,i,n,o){var r,_,l,d,c,u,p,m,g,k,b,h,y,f,v,w,z,S={width:0,height:0},j=e._children,P=0,A="px",T=[],I=0,x=0,M=j.length,N=this._measureNode;for(P=0;M>P;P++)r=e._children[P],r._alive&&r.domNode?r._markedForLayout&&((r._preLayout&&r._preLayout(a,i,n,o)||r._needsMeasuring)&&N(r,r,r._layoutCoefficients,this),_=r._layoutCoefficients,d=_.height,0===d.x2||isNaN(d.x2)?(l=_.width,c=_.sandboxWidth,u=_.sandboxHeight,k=l.x1*a+l.x2,b=d.x1*i+d.x2*(i-I)+d.x3,g=r._getContentSize?r._getContentSize(k,b):r._layout._doLayout(r,isNaN(k)?a:k-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?i:b-r._borderTopWidth-r._borderBottomWidth,isNaN(k),isNaN(b)),isNaN(k)&&(k=g.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=g.height+r._borderTopWidth+r._borderBottomWidth),h=r._measuredSandboxHeight=u.x1*i+u.x2+b,I+=h,r._measuredWidth=k,r._measuredHeight=b):x++):this.handleInvalidState(r,e);for(w=i-I,I=Math.floor(w/x),P=0;M>P;P++)r=e._children[P],r._markedForLayout&&(_=r._layoutCoefficients,d=_.height,0===d.x2||isNaN(d.x2)||(l=_.width,c=_.sandboxWidth,u=_.sandboxHeight,k=l.x1*a+l.x2,b=d.x1*i+d.x2*(M-1>P?I:w-I*(x-1))+d.x3,g=r._getContentSize?r._getContentSize(k,b):r._layout._doLayout(r,isNaN(k)?a:k-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?i:b-r._borderTopWidth-r._borderBottomWidth,isNaN(k),isNaN(b)),isNaN(k)&&(k=g.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=g.height+r._borderTopWidth+r._borderBottomWidth),r._measuredWidth=k,r._measuredHeight=b,h=r._measuredSandboxHeight=u.x1*i+u.x2+b));for(I=0,P=0;M>P;P++)r=e._children[P],r._measuredRunningHeight=I,r._markedForLayout?(_=r._layoutCoefficients,c=_.sandboxWidth,p=_.top,m=_.left,n&&0!==m.x1?T.push(r):(k=r._measuredWidth,f=r._measuredLeft=m.x1*a+m.x2*k+m.x3,y=r._measuredSandboxWidth=c.x1*a+c.x2+k+(isNaN(f)?0:f),r._measuredSandboxWidth>S.width&&(S.width=r._measuredSandboxWidth)),v=r._measuredTop=p.x1*i+p.x2+I):r._measuredSandboxWidth>S.width&&(S.width=r._measuredSandboxWidth),I+=r._measuredSandboxHeight;for(S.height=I,M=T.length,P=0;M>P;P++)r=T[P],c=r._layoutCoefficients.sandboxWidth,y=r._measuredSandboxWidth=c.x1*a+c.x2+r._measuredWidth,y>S.width&&(S.width=y);for(P=0;M>P;P++)r=T[P],m=r._layoutCoefficients.left,c=r._layoutCoefficients.sandboxWidth,k=r._measuredWidth,y=r._measuredSandboxWidth,y>S.width&&(S.width=y),f=r._measuredLeft=m.x1*S.width+m.x2*k+m.x3,r._measuredSandboxWidth+=isNaN(f)?0:f;for(M=j.length,P=0;M>P;P++)r=j[P],r._markedForLayout&&(t._elementLayoutCount++,r=j[P],z=r.domNode.style,z.zIndex=r.zIndex,z.left=s(r._measuredLeft)+A,z.top=s(r._measuredTop)+A,z.width=s(r._measuredWidth-r._borderLeftWidth-r._borderRightWidth)+A,z.height=s(r._measuredHeight-r._borderTopWidth-r._borderBottomWidth)+A,r._markedForLayout=!1,r.fireEvent("postlayout"));return this._computedSize=S},_getWidth:function(e,a){return!n(a)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(a=e._defaultWidth),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_getHeight:function(e,a){return!n(a)&&(a=e._defaultHeight),a===t.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===t.SIZE?t.SIZE:t.FILL:t.FILL:a},_isDependentOnParent:function(e){var a=e._layoutCoefficients;return!isNaN(a.width.x1)&&0!==a.width.x1||!isNaN(a.height.x1)&&0!==a.height.x1||!isNaN(a.height.x2)&&0!==a.height.x2||0!==a.sandboxWidth.x1||0!==a.sandboxHeight.x1||0!==a.left.x1||0!==a.top.x1},_doAnimationLayout:function(e,a){var t=e._parent._measuredWidth,i=e._parent._measuredHeight,n=e._measuredRunningHeight,s=a.width.x1*t+a.width.x2;return{width:s,height:a.height.x1*i+a.height.x2*(i-n)+a.height.x3,left:a.left.x1*t+a.left.x2*s+a.left.x3,top:a.top.x1*i+a.top.x2+n}},_measureNode:function(e,a,i,n){e._needsMeasuring=!1;var s,o,r,_=n.getValueType,l=n.computeValue,d=n._getWidth(e,a.width),c=_(d),u=l(d,c),p=n._getHeight(e,a.height),m=_(p),g=l(p,m),k=a.left,b=_(k),h=l(k,b),y=a.center&&a.center.x,f=_(y),v=l(y,f),w=a.right,z=_(w),S=l(w,z),j=a.top,P=_(j),A=l(j,P),T=a.bottom,I=_(T),x=l(T,I),M=i.width,N=i.height,D=i.sandboxWidth,C=i.sandboxHeight,B=i.left,W=i.top;if(s=o=0,c===t.SIZE?s=o=0/0:c===t.FILL?(s=1,"%"===b?s-=h:"#"===b?o=-h:"%"===z?s-=S:"#"===z&&(o=-S)):"%"===c?s=u:"#"===c?o=u:"%"===b?"%"===f?s=2*(v-h):"#"===f?(s=-2*h,o=2*v):"%"===z?s=1-h-S:"#"===z&&(s=1-h,o=-S):"#"===b?"%"===f?(s=2*v,o=-2*h):"#"===f?o=2*(v-h):"%"===z?(s=1-S,o=-h):"#"===z&&(s=1,o=-S-h):"%"===f?"%"===z?s=2*(S-v):"#"===z&&(s=-2*v,o=2*S):"#"===f&&("%"===z?(s=2*S,o=-2*v):"#"===z&&(o=2*(S-v))),M.x1=s,M.x2=o,D.x1="%"===z?S:0,D.x2="#"===z?S:0,s=o=r=0,m===t.SIZE?s=o=r=0/0:m===t.FILL?(o=1,"%"===P&&(s=-A),"#"===P&&(r=-A),"%"===I&&(s=-x),"#"===I&&(r=-x)):"%"===m?s=g:"#"===m&&(r=g),N.x1=s,N.x2=o,N.x3=r,s=o=0,"%"===P&&(s=A),"#"===P&&(o=A),"%"===I&&(s+=x),"#"===I&&(o+=x),C.x1=s,C.x2=o,s=o=r=0,"%"===b)s=h;else if("#"===b)r=h;else if("%"===f)s=v,o=-.5;else if("#"===f)o=-.5,r=v;else if("%"===z)s=1-S,o=-1;else if("#"===z)s=1,o=-1,r=-S;else switch(n._defaultHorizontalAlignment){case"center":s=.5,o=-.5;break;case"end":s=1,o=-1}B.x1=s,B.x2=o,B.x3=r,W.x1="%"===P?A:0,W.x2="#"===P?A:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});