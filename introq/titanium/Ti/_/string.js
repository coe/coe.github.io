define(["Ti/_","Ti/_/has","Ti/_/lang"],function(e,a,t){function i(e,a,t){var i,n=a-10;for(d(e.arg,"String")||(e.arg=""+e.arg);n>e.arg.length;)e.arg=e.rightJustify?e.arg+t:t+e.arg;i=a-e.arg.length,e.arg=e.rightJustify?e.arg+t.substring(0,i):t.substring(0,i)+e.arg}function n(e,a){i(e,t.val(a,e.precision),p)}function s(e,a){i(e,t.val(a,e.minWidth),m)}function o(e){e.maxWidth>=0&&e.arg.length>e.maxWidth?e.arg.substring(0,e.maxWidth):e.zeroPad?n(e,e.minWidth):s(e)}function r(e){var a=parseInt(e.arg);isFinite(a)||(l(!d(e.arg,"Number"),"Format argument '"+e.arg+"' not an integer; parseInt returned "+a),a=0),0>a&&(e.isUnsigned||10!=e.base)&&(a=4294967295+a+1),0>a?(e.arg=(-a).toString(e.base),n(e),e.arg="-"+e.arg):(e.arg=a.toString(e.base),a||e.precision?n(e):e.arg="",e.sign&&(e.arg=e.sign+e.arg)),16===e.base&&(e.alternative&&(e.arg="0x"+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()),8===e.base&&e.alternative&&"0"!=e.arg.charAt(0)&&(e.arg="0"+e.arg)}function _(e){var a=parseFloat(e.arg);switch(isFinite(a)||(l(!d(e.arg,"Number"),"Format argument '"+e.arg+"' not a float; parseFloat returned "+a),a=0),e.specifier){case"e":e.arg=a.toExponential(e.precision);break;case"f":e.arg=a.toFixed(e.precision);break;case"g":e.arg=1e-4>Math.abs(a)?a.toExponential(e.precision>0?e.precision-1:e.precision):a.toPrecision(e.precision),e.alternative||(e.arg=e.arg.replace(/(\..*[^0])0*/,"$1"),e.arg=e.arg.replace(/\.0*e/,"e").replace(/\.0$/,""));break;default:throw Error("Unexpected double notation '"+e.doubleNotation+"'")}e.arg=e.arg.replace(/e\+(\d)$/,"e+0$1").replace(/e\-(\d)$/,"e-0$1"),u&&(e.arg=e.arg.replace(/^\./,"0.")),e.alternative&&(e.arg=e.arg.replace(/^(\d+)$/,"$1."),e.arg=e.arg.replace(/^(\d+)e/,"$1.e")),a>=0&&e.sign&&(e.arg=e.sign+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()}var l=e.assert,d=require.is,c=require.mix,u=a("opera"),p="0000000000",m="          ",g={b:{base:2,isInt:1},o:{base:8,isInt:1},x:{base:16,isInt:1},X:{extend:["x"],toUpper:1},d:{base:10,isInt:1},i:{extend:["d"]},u:{extend:["d"],isUnsigned:1},c:{setArg:function(e){if(!isNaN(e.arg)){var a=parseInt(e.arg);l(0>a||a>127,"Invalid character code passed to %c in sprintf"),e.arg=isNaN(a)?""+a:String.fromCharCode(a)}}},s:{setMaxWidth:function(e){e.maxWidth="."===e.period?e.precision:-1}},e:{isDouble:1},E:{extend:["e"],toUpper:1},f:{isDouble:1},F:{extend:["f"]},g:{isDouble:1},G:{extend:["g"],toUpper:1}};return String.format=function(e){for(var a,i,n,s,p=t.toArray(arguments),m=/\%(?:\(([\w_]+)\)|([1-9]\d*)\$)?([0 +\-\#]*)(\*|\d+)?(\.)?(\*|\d+)?[hlL]?([\%scdeEfFgGiouxX])/g,k=[],b=0,h=0,y=0,f="",v=["mapping","intmapping","flags","_minWidth","period","_precision","specifier"];i=m.exec(e);){if(s=e.slice(h,m.lastIndex-i[0].length),s.length&&k.push(s),u){for(n=i.slice(0);n.length<i.length;)n.push(null);i=n}a={},i.slice(1).concat(k.length).map(function(e,t){v[t]&&(a[v[t]]=e)}),k.push(a),a[0]&&b++,h=m.lastIndex}return s=e.slice(h),s.length&&k.push(s),p.shift(),l(!b||p.length,"Format has no mapped arguments"),k.forEach(function(a){var t,i,n,s={},u=g[a.specifier];if(d(a,"String"))f+=a;else{if(b?l(void 0===p[a.mapping],"Missing key "+a.mapping):(a.intmapping&&(y=parseInt(a.intmapping)-1),l(p.length>y,"Got "+p.length+" format arguments, insufficient for '"+e+"'")),a.arg=p[b?a.mapping:y++],!a.compiled){for(c(a,{compiled:1,sign:"",zeroPad:0,rightJustify:0,alternative:0,minWidth:0|a._minWidth,maxWidth:-1,toUpper:0,isUnsigned:0,isInt:0,isDouble:0,precision:"."===a.period?0|a._precision:1}),t=a.flags,i=t.length;i--;)switch(s[n=t.charAt(i)]=1,n){case" ":a.sign=" ";break;case"+":a.sign="+";break;case"0":a.zeroPad=!s["-"];break;case"-":a.rightJustify=1,a.zeroPad=0;break;case"#":a.alternative=1;break;default:throw Error("Bad formatting flag '"+n+"'")}l(void 0!==u,"Unexpected specifier '"+a.specifier+"'"),u.extend&&(c(u,g[u.extend]),delete u.extend),c(a,u)}d(a.setArg,"Function")&&a.setArg(a),d(a.setMaxWidth,"Function")&&a.setMaxWidth(a),"*"===a._minWidth&&(l(b,"* width not supported in mapped formats"),l(isNaN(a.minWidth=parseInt(p[y++])),"The argument for * width at position "+y+" is not a number in "+this._format),0>a.minWidth&&(a.rightJustify=1,a.minWidth=-a.minWidth)),"*"===a._precision&&"."===a.period&&(l(b,"* precision not supported in mapped formats"),l(isNaN(a.precision=parseInt(p[y++])),"The argument for * precision at position "+y+" is not a number in "+this._format),0>a.precision&&(a.precision=1,a.period="")),a.isInt?("."===a.period&&(a.zeroPad=0),r(a)):a.isDouble&&("."!==a.period&&(a.precision=6),_(a)),o(a),f+=""+a.arg}}),f},{capitalize:function(e){return e=e||"",e.substring(0,1).toUpperCase()+e.substring(1)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}});