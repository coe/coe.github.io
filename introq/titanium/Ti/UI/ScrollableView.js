define(["Ti/_/declare","Ti/UI/View","Ti/_/dom","Ti/_/has","Ti/_/style","Ti/UI","Ti/_/browser"],function(e,a,t,i,n,s,o){var r=n.set,_=require.is,l=t.unitize,d=require.on,c=d.once,u=window,p={webkit:"webkitTransitionEnd",trident:"msTransitionEnd",gecko:"transitionend",presto:"oTransitionEnd"},m=p[o.runtime]||"transitionEnd",g=i("touch"),k=200,b=10,h=25,y=1e3,f=.5,v=2;return e("Ti.UI.ScrollableView",a,{constructor:function(){var e,a=this,t=0;a._add(a._contentContainer=s.createView({left:0,top:0,width:s.SIZE,height:"100%",layout:"constrainingHorizontal"})),e=a._contentContainer.domNode,a._add(a._pagingControlContainer=s.createView({width:"100%",height:20,bottom:0,backgroundColor:"black",opacity:0,touchEnabled:!1})),a._pagingControlContainer._add(a._pagingControlContentContainer=s.createView({width:s.SIZE,height:"100%",top:0,touchEnabled:!1,layout:"constrainingHorizontal"})),a.properties.__values__.views=[],a._viewToRemoveAfterScroll=-1,d(a,"postlayout",function(){a._animating||a._setTranslation(a.currentPage*-a._measuredWidth)}),d(e,g?"touchstart":"mousedown",function(i){var n=i.touches?i.touches[0].clientX:i.clientX,s=n,o=Date.now(),_=a._measuredWidth,l=function(e){var i=a.currentPage,o=s-n+t;_=a._measuredWidth,e.preventDefault(),s=e.touches?e.touches[0].clientX:e.clientX,a._setTranslation(i*-_+o),a.fireEvent("scroll",{currentPage:i,currentPageAsFloat:i-o/_,view:a.views[i]})},d=function(i){var p=Date.now(),w=k>p-o,z=a.currentPage,S=Math.abs(n-s)>(w?b:_/2),j=a.properties.__values__,P=Math.abs(s-n);u.removeEventListener(g?"touchmove":"mousemove",l),u.removeEventListener(g?"touchend":"mouseup",d),_=a._measuredWidth,a._animating=1,i.preventDefault(),S&&(n>s?z!==j.views.length-1&&z++:0!==z&&z--,P=_-P),a._showPagingControl(z),t=s-n+t,P=Math.max(h,Math.min(y,(w?f:v)*P)),r(e,"transition",P+"ms ease-out"),setTimeout(function(){c(e,m,function(){r(e,"transition",""),a._animating=0,j.currentPage=z,a._updatePagingControl(),a.fireEvent("scrollend",{currentPage:z,view:a.views[z]})}),a._setTranslation(z*-_)},1),a.fireEvent("dragend",{currentPage:z,view:a.views[z]})};a._showPagingControl(a.currentPage,1),i.preventDefault(),t=a._animating?t||0:0,r(e,"transition",""),a._setTranslation(a.currentPage*-_+t),a._animating=0,u.addEventListener(g?"touchmove":"mousemove",l),u.addEventListener(g?"touchend":"mouseup",d),a.fireEvent("dragstart")})},_setTranslation:function(e){r(this._contentContainer.domNode,"transform","translatez(0) translatex("+e+"px)")},_showPagingControl:function(e,a){var t=this;return t.showPagingControl?(t._pagingAnimation&&t._pagingAnimation.cancel(),t._pagingAnimation=t._pagingControlContainer.animate({duration:250,opacity:.75}),clearInterval(t._pagingTimeout),!a&&t.pagingControlTimeout>0?t._pagingTimeout=setTimeout(function(){t._pagingAnimation&&t._pagingAnimation.cancel(),t._pagingAnimation=t._pagingControlContainer.animate({duration:750,opacity:0},function(){t._pagingAnimation=void 0})},t.pagingControlTimeout):t._pagingAnimation=void 0,void 0):(t._pagingControlContainer.opacity=0,void 0)},_updatePagingControl:function(){var e=this._pagingControlContentContainer,a=this.views.length,t=this.pagingControlHeight/2;if(a!==e._numViews||t!==e._diameter){e._numViews=a,e._diameter=t,e._removeAllChildren();for(var i=0;this.views.length>i;i++)e._add(s.createView({width:t,height:t,left:5,right:5,backgroundColor:"#aaa",borderRadius:l(t/2)}));e._highlightedPage=-1}e._highlightedPage!==this.currentPage&&(0>e._highlightedPage||(e._children[e._highlightedPage].backgroundColor="#aaa"),e._children[this.currentPage].backgroundColor="#fff",e._highlightedPage=this.currentPage)},addView:function(e){e&&(e.width="100%",e.height="100%",this.views.push(e),this._contentContainer._add(e),1==this.views.length&&(this.properties.__values__.currentPage=0),this._updatePagingControl())},removeView:function(e){var a=_(e,"Number")?e:this.views.indexOf(e);0>a||a>=this.views.length||(a==this.currentPage&&1!==this.views.length?(this._viewToRemoveAfterScroll=a,this.scrollToView(a==this.views.length-1?--a:++a)):this._removeViewFromList(a))},_removeViewFromList:function(e){var a=this._contentContainer,t=this;this.currentPage>e&&t.properties.__values__.currentPage--,a._remove(t.views.splice(e,1)[0]),t.views.length||(t.properties.__values__.currentPage=-1),c(s,"postlayout",function(){setTimeout(function(){t._setTranslation(t.currentPage*-t._measuredWidth)},1)})},scrollToView:function(e,a){function t(){var e=n._contentContainer,t=e.domNode,s=-n.views[i]._measuredLeft,o=Math.max(h,Math.min(y,v*e._measuredWidth));n._updatePagingControl(),n._showPagingControl(i),a?(n._setTranslation(s),n.properties.__values__.currentPage=i):(r(t,"transition",o+"ms ease-out"),setTimeout(function(){c(t,m,function(){r(t,"transition",""),n._animating=0,n.properties.__values__.currentPage=i,n._updatePagingControl(),-1!==n._viewToRemoveAfterScroll&&(s+=n.views[n._viewToRemoveAfterScroll]._measuredWidth,n._removeViewFromList(n._viewToRemoveAfterScroll),n._viewToRemoveAfterScroll=-1),n.fireEvent("scrollend",{currentPage:i,view:n.views[i]})}),n._setTranslation(s)},1))}var i=_(e,"Number")?e:this.views.indexOf(e),n=this;0>i||i>=this.views.length||i==this.currentPage||(n._contentContainer.domNode.offsetWidth?t():c(n,"postlayout",t))},_defaultWidth:s.FILL,_defaultHeight:s.FILL,properties:{currentPage:{set:function(e,a){return e>=0&&this.views.length>e?(this.scrollToView(e,1),e):a},value:-1},pagingControlColor:{set:function(e){return this._pagingControlContainer.backgroundColor=e,e},value:"black"},pagingControlHeight:{set:function(e){return this._pagingControlContainer.height=e,e},value:20},pagingControlTimeout:{post:function(e){e||(this._pagingControlContainer.opacity=.75)},value:3e3},showPagingControl:!1,views:{set:function(e){if(_(e,"Array")){var a,t=0,i=e.length,n=this._contentContainer;for(n._removeAllChildren();i>t;t++)(a=e[t]).width="100%",a.height="100%",n._add(a);return this.properties.__values__.currentPage=i?0:-1,e}},post:"_updatePagingControl"}}})});